var DropDown=function(a,b){this.id=a,this.select=null,this.options=null,this.ul=null,this.ul_top=0,this.span=null,this.init=function(){this.select=$(a),this.select.addEvent("change",this.updateDropDown.bind(this)),"function"==typeof b&&(this.value_callback=b),this.options=this.select.getElements("option"),this.buildDropDown(),this.hideDropDown()},this.buildDropDown=function(){var a=new Element("div",{id:"js_dropdown_"+this.id,"class":"js_dropdown",events:{mouseleave:this.hideDropDown.bind(this)}});this.span=new Element("span",{events:{click:this.showDropDown.bind(this)}}).set("text",this.options[this.select.selectedIndex].get("text")),this.ul=new Element("ul");for(var b=!1,c=0;c<this.options.length;c++){var d=new Element("li",{events:{click:this.selectOption.bind(this)},"class":"optionindex"+new String(c)}).injectInside(this.ul);this.value_callback(d,this.options[c].get("text")),"product_id"!=this.id||b||(this.options[c].get("text").length>30||(this.options[c].get("text").match(/,/g)||[]).length>1)&&(b=!0)}this.span.injectInside(a),this.ul.injectInside(a),a.injectAfter(this.select);var e=parseInt(this.span.getStyle("padding-left")),f=parseInt(this.span.getStyle("border-left-width")),g=parseInt(this.span.getStyle("padding-right"))-e,h=this.ul.getSize(),i=this.span.getStyle("background-position");i="undefined"==typeof i||""==i?this.span.getStyle("background-position-y"):i.split(" ")[1],this.span.setStyles({width:h.x-2*e,"background-position":String(h.x)+"px "+i}),a.setStyle("position","relative"),ul_width=h.x+g-2+2*f,ul_width<500&&1==b,this.ul_top=this.span.getSize().y-f,this.ul.setStyles({left:0,top:this.ul_top,width:ul_width}),this.select.setStyle("display","none")},this.value_callback=function(a,b){a.set("text",b)},this.showDropDown=function(){this.ul.setStyle("display","block"),this.fixPosition()},this.hideDropDown=function(){this.ul.setStyle("display","none"),this.ul.setStyle("top",this.ul_top)},this.fixPosition=function(){for(var a=0,b=this.ul.getParents(),c=b.length;c>a;a++)if("hidden"==b[a].getStyle("overflow")||"hidden"==b[a].getStyle("overflow-y")){var d=this.ul.getCoordinates(b[a]);d.top+d.height>b[a].getCoordinates().height+b[a].getScroll().y&&this.ul.setStyle("top",-d.height);break}},this.selectOption=function(a){var b=new Event(a),c="li"==b.target.get("tag")?b.target:b.target.getParent();this.select.selectedIndex=c.className.substr(11),this.updateDropDown(),this.select.fireEvent("change"),this.hideDropDown()},this.updateDropDown=function(){this.span.set("text",this.options[this.select.selectedIndex].get("text"))},this.init()};