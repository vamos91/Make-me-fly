var MooPrompt=box=new Class({Implements:[Options,Chain],options:{buttons:0,width:300,height:0,maxHeight:1e3,vertical:"middle",horizontal:"center",delay:0,overlay:!0,showCloseBtn:!0,effect:"grow"},initialize:function(t,i,o){this.setOptions(o),this.title=t,this.text=i,this.options.overlay&&(this.overlay=new Element("div").setProperty("class","cbOverlay"),this.overlay.setStyles({position:"absolute",top:0,left:0,width:"100%",visibility:"hidden"}).injectInside(document.body)),this.container=new Element("div").setProperty("class","cbContainer"),this.container.setStyles({position:"absolute",visibility:"hidden"}).injectInside(document.body),this.box=new Element("div").setProperty("class","cbBox"),this.box.setStyles({width:this.options.width+"px",overflow:"hidden"}).injectInside(this.container),(""==this.box.getStyle("background-color")||"transparent"==this.box.getStyle("background-color"))&&this.box.setStyle("background-color",this.container.getStyle("background-color")),this.options.showCloseBtn&&(this.closeBtn=new Element("div").setProperty("class","cbCloseButton"),this.closeBtn.onclick=this.close.pass(["close"],this),this.closeBtn.injectInside(this.box)),this.content=new Element("div").setProperty("class","cbContent").injectInside(this.box),"element"==$type(i)?i.injectInside(this.content):this.content.setHTML(this.text),this.buttons=new Element("div").setProperty("class","cbButtons").injectInside(this.box),(""==this.buttons.getStyle("background-color")||"transparent"==this.buttons.getStyle("background-color"))&&this.buttons.setStyle("background-color",this.box.getStyle("background-color"));for(var e=1;e<=this.options.buttons;e++)"undefined"==typeof this.options["button"+e]&&(this.options["button"+e]="Button"),"element"==$type(this.options["button"+e])?(this["button"+e]=this.options["button"+e],this["button"+e].injectInside(this.buttons)):this["button"+e]=new Element("input").setProperties({type:"button",value:this.options["button"+e]}).injectInside(this.buttons),"undefined"==typeof this.options["button"+e]&&(this.options["onButton"+e]=Class.empty),this["button"+e].setProperty("class","button cbButton"),this["button"+e].onclick=this.close.pass([this.options["onButton"+e]],this);if(this.boxHeight=this.box.offsetHeight<this.options.maxHeight?this.box.offsetHeight:this.options.maxHeight,this.boxHeight=this.options.height>0?this.options.height:this.boxHeight,this._position(),this.eventPosition=this._position.bind(this),window.addEvent("scroll",this.eventPosition).addEvent("resize",this.eventPosition),this.box.setStyle("display","none"),this.options.overlay&&(this.fx1=new Fx.Style(this.overlay,"opacity",{duration:100}).custom(0,.7)),"grow"==this.options.effect){this.container.setStyle("top",Window.getScrollTop()+Window.getHeight()/2+"px");var s={};s.height=0,s.width=0,"center"!=this.options.horizontal&&(s[this.options.horizontal]=this.options.width/2+"px"),"top"==this.options.vertical?s[this.options.vertical]=Window.getScrollTop()+this.boxHeight/2+"px":"bottom"==this.options.vertical&&(s.top=Window.getScrollTop()+Window.getHeight()-this.boxHeight/2-25+"px"),this.container.setStyles(s),this.container.setStyle("visibility",""),this.fx2=new Fx.Styles(this.container,{duration:100}),this.fx2.custom({width:[0,this.options.width],"margin-left":[0,-this.options.width/2],"margin-right":[0,-this.options.width/2],height:[0,this.boxHeight],"margin-top":[0,-this.boxHeight/2],"margin-bottom":[0,-this.boxHeight/2]}).chain(function(){this.box.setStyles({visibility:"hidden",display:"",height:this.boxHeight+"px"}),new Fx.Style(this.box,"opacity",{duration:100}).custom(0,1).chain(function(){this.options.delay>0&&function(){this.close()}.bind(this).delay(this.options.delay)}.bind(this))}.bind(this))}else{this.container.setStyles({height:this.boxHeight,width:this.options.width,left:"",visibility:"hidden"}),this.box.setStyles({visibility:"",display:"",height:this.boxHeight+"px"}),this.fx2=new Fx.Styles(this.container,{duration:100});var n={};"center"!=this.options.horizontal?n[this.options.horizontal]=[-this.options.width,0]:this.container.setStyles({left:"50%","margin-left":-this.options.width/2+"px","margin-right":-this.options.width/2+"px"}),"top"==this.options.vertical?n[this.options.vertical]=[Window.getScrollTop()-this.boxHeight,Window.getScrollTop()]:"bottom"==this.options.vertical?n.top=[Window.getScrollTop()+Window.getHeight(),Window.getScrollTop()+Window.getHeight()-this.boxHeight-25]:this.container.setStyles({top:Window.getScrollTop()+Window.getHeight()/2+"px","margin-top":-this.boxHeight/2+"px","margin-bottom":-this.boxHeight/2+"px"}),n.opacity=[0,1],this.fx2.custom(n).chain(function(){this.options.delay>0&&function(){this.close()}.bind(this).delay(this.options.delay)}.bind(this))}},_position:function(){var t="grow"==this.options.effect?this.options.width/2:0,i="grow"==this.options.effect?this.boxHeight/2:0;if(this.options.overlay){var o=Window.getScrollHeight()>Window.getHeight()?Window.getScrollHeight():Window.getHeight();this.overlay.setStyles({height:o+"px"})}switch(this.options.vertical){case"top":this.container.setStyle("top",Window.getScrollTop()+i+"px");break;case"middle":this.container.setStyle("top",Window.getScrollTop()+Window.getHeight()/2+"px");break;case"bottom":this.container.setStyle("top",Window.getScrollTop()+Window.getHeight()-this.boxHeight+i-25+"px")}"center"==this.options.horizontal?this.container.setStyle("left","50%"):this.container.setStyle(this.options.horizontal,t+"px")},close:function(t){for(var i=1;i<=this.options.buttons;i++)this["button"+i].onclick=null;this.options.overlay&&this.fx1.clearTimer(),this.fx2.clearTimer(),"function"==typeof t&&t(),this.options.overlay&&new Fx.Style(this.overlay,"opacity",{duration:250}).custom(.8,0),new Fx.Style(this.container,"opacity",{duration:250,onComplete:function(){window.removeEvent("scroll",this.eventPosition).removeEvent("resize",this.eventPosition),this.options.overlay&&this.overlay.remove();try{this.container.remove()}catch(t){}}.bind(this)}).custom(1,0)}});