var NewsletterFormHandler=function(a,b){this.__formElement=a,this.__emailField=this.__formElement.getElements(".newsletter_email")[0],this.__mensButton=this.__formElement.getElements(".mens_button")[0],this.__womensButton=this.__formElement.getElements(".womens_button")[0],"undefined"==typeof b?this.__source="website":this.__source=b,this.__request=new Request.JSON({url:"index.php",link:"ignore",onSuccess:this.__submitResponse.bind(this)}),a.addEvent("submit",function(a){return a.preventDefault(),!1}),this.__mensButton.addEvent("click",function(){this.subscribe(this.__mensButton.value)}.bind(this)),this.__womensButton.addEvent("click",function(){this.subscribe(this.__womensButton.value)}.bind(this))};NewsletterFormHandler.prototype.subscribe=function(a){if(document.formvalidator.isValid(this.__formElement)){var b={option:"com_virtuemart",page:"shop.newsletter",newsletter_email:this.__emailField.value,newsletter_category:a,source:this.__source,only_page:1};void 0!=typeof $("csrf_token").name&&(b[$("csrf_token").name]=1),this.__request.post(b)}else this.__invalidNotify()},NewsletterFormHandler.prototype.__invalidNotify=function(){Template.popup(lang_theme_please_email,"close_timeout"),Template.Utilities.trackEvent("Error Message","Newsletter sign-up",lang_theme_please_email)},NewsletterFormHandler.prototype.__submitResponse=function(a){if("true"==a.success)null!=$("tracking_div")&&($("tracking_div").innerHTML=""),Template.popup(lang_theme_newsletter_thanks,"newsletter"),Template.Utilities.trackEvent("Account","Newsletter sign-up",this.__emailField.value),Template.Utilities.trackFormSubmit("Newsletter");else{var b='<div class="popup-message error"><p>'+lang_theme_please_email+"</p></div>";Template.popup(b,"close_timeout"),Template.Utilities.trackEvent("Error Message","Newsletter sign-up",a.message)}};