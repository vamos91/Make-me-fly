function fsm_auto_htmlEncode(n){return jQuery("<div><\/div>").text(n).html()}function fsm_auto_htmlDecode(n){return jQuery("<div><\/div>").html(n).text()}(function(n){n.fn.fsmAutocomplete=function(t){function r(){i.autoPositionDropDown;n(i.dropDownSelector).show()}function u(){n("div.fsm_auto_itemFocus").removeClass("fsm_auto_itemFocus");n(i.dropDownSelector).hide()}function f(t,r){var o=t.keyCode?t.keyCode:t.which,u,f,e;o!=38&&o!=40&&o!=50&&(u=n(r).val().toLowerCase(),i.searchTerm=u,i.showDropDown(),f=fsm_auto_getPopularSearchTerms({term:u,count:i.searchTermCount,operator:i.searchOperator}),e=fsm_auto_getPopularProducts({term:u,count:i.productCount,fields:i.searchFields,operator:i.productsOperator}),i.buildPopularSearchTerms(f,r),i.buildPopularProducts(e,r),i.buildDropDownComplete(f,e),f.length==0&&e.length==0&&i.hideDropDown())}function e(t,r){for(var e,f=[],u=0;u<t.length;u++)e=t[u].term,f.push('<div class="fsm_auto_searchItem" data-fsm-auto-type="search">'+fsm_auto_htmlEncode(e)+"<\/div>");n(i.searchTermsSelector).html(f.join(""));n("div.fsm_auto_searchItem",i.searchTermsSelector).click(function(){i.searchItemSelected(n(this).text(),r)})}function o(t,i){n(i).val(t)}function s(t,r){for(var e,o,f=[],u=0;u<t.length;u++)e=t[u].title,o=t[u].sku,f.push('<div class="fsm_auto_productItem" data-fsm-auto-type="product">'+e+"<\/div>");n(i.productsSelector).html(f.join(""));n("div.fsm_auto_productItem",i.productsSelector).click(function(){i.productItemSelected(n(this).text(),r)})}function h(t,i){n(i).val(t)}function c(t,i){var r=n("div.fsm_auto_searchItem,div.fsm_auto_productItem"),u=r.length-1,f,e,o;r.each(function(t){n(this).hasClass("fsm_auto_itemFocus")&&(n(this).removeClass("fsm_auto_itemFocus"),u=t-1)});u>=0?(f=n(r[u]).addClass("fsm_auto_itemFocus"),e=f.attr("data-fsm-auto-title"),e?n(i).val(e):n(i).val(f.text())):(o=n(i).attr("data-fsm-auto-manual-value"),n(i).val(o))}function l(t,i){var r=n("div.fsm_auto_searchItem,div.fsm_auto_productItem"),u=0,f,e,o;r.each(function(t){n(this).hasClass("fsm_auto_itemFocus")&&(n(this).removeClass("fsm_auto_itemFocus"),u=t+1)});u<r.length?(f=n(r[u]).addClass("fsm_auto_itemFocus"),e=f.attr("data-fsm-auto-title"),e?n(i).val(e):n(i).val(f.text())):(o=n(i).attr("data-fsm-auto-manual-value"),n(i).val(o))}function a(t){var v=i.searchTerm,u=t.split(" "),h=n.trim(v).toLowerCase().split(" "),o,r,c,f,e,l,s,a;for(o in u){r="";for(c in h)f=u[o],e=h[c],f.toLowerCase().indexOf(e)==0&&e.length>r.length&&(r=e);if(r!=""){l=r.length;s=f.substring(0,l);try{a=new RegExp("^"+s,"i");u[o]=f.replace(a,i.highlightFunction(s))}catch(y){}}}return u.join(" ")}function v(n){return'<span class="AutoHighlight">'+n+"<\/span>"}var i=n.extend({searchTermsTitle:"Popular Searches",productsTitle:"Product Matches",dropDownSelector:"#AutoComplete",dropDownContainer:"body",searchTermsSelector:"#AutoSearches",productsSelector:"#AutoProducts",searchTermCount:5,productCount:5,autoPositionDropDown:!1,underlineMatches:!0,buildPopularSearchTerms:function(n,t){e(n,t)},buildPopularProducts:function(n,t){s(n,t)},buildDropDownComplete:function(){},searchItemSelected:function(n,t){o(n,t)},productItemSelected:function(n,t){h(n,t)},showDropDown:function(){r()},hideDropDown:function(){u()},productUrl:null,searchOperator:"OR",productsOperator:"OR",highlightFunction:function(n){return v(n)},highlightMatches:function(n){return a(n)},searchFields:["sku","title"],searchTerm:""},t);return n(i.dropDownSelector).length==0&&n(i.dropDownContainer).append('<div id="AutoComplete"><h3 id="AutoSearchesTitle">'+i.searchTermsTitle+'<\/h3><div id="AutoSearches"><\/div><h3 id="AutoProductsTitle">'+i.productsTitle+'<\/h3><div id="AutoProducts"><\/div><\/div>'),n("body").click(function(){n(this).attr("data-fsm-auto-manual-value",n(this).val());i.hideDropDown()}),this.each(function(){var t=n(this).closest("form");t.length>0&&(i.form=t.get(0),t.submit(function(){return i.productUrl?(window.location=i.productUrl,!1):!0}));n(this).attr("autocomplete","off").click(function(){return!1}).keydown(function(t){var u=t.keyCode?t.keyCode:t.which,r,f;return(i.productUrl=null,u==38)?(r=n(this).val(),r==""?i.hideDropDown():i.showDropDown(),c(t,this),!1):u==40?(r=n(this).val(),r==""?i.hideDropDown():i.showDropDown(),l(t,this),!1):u==13?(f=n("div.fsm_auto_itemFocus[data-fsm-auto-url]"),f.length>0&&(i.productUrl=n("div.fsm_auto_itemFocus").attr("data-fsm-auto-url")),!0):void 0}).keyup(function(t){var r=t.keyCode?t.keyCode:t.which,u;return r==13?!0:r!=38&&r!=40?(u=n(this).val(),n(this).attr("data-fsm-auto-manual-value",u),f(t,this),u==""&&i.hideDropDown(),!1):!0}).blur(function(){return})})}})(jQuery)