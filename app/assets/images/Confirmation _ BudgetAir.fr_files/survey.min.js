var srv=function(){function loadSurvey(e){if("object"==typeof e)this.domain=void 0!==e.domain?e.domain:domain,this.key=e.key,this.div_name=e.divName,this.remote=void 0===e.remote||e.remote;else try{console.error(arguments.callee.name+": No input received")}catch(e){}if(this.url=this.host+"/survey/public/collect-stream?key="+this.key+"&domain="+this.domain,"undefined"!=typeof mpnndbg&&(this.url+="&debug="+(mpnndbg?1:0)),void 0!==e.button&&(this.url+="&button="+e.button),void 0!==e.modal){this.outer_modal=e.modal,this.url+="&modal="+this.outer_modal;t=" is-modal"}else{this.outer_modal=!0;var t=" is-embed"}if(this.url+="&version="+version,this.div_name)if(document.getElementById(this.div_name))document.getElementById(this.div_name).className+="sd-loading"+t;else try{console.warn(arguments.callee.name+": Output div doesn't exist")}catch(e){}else try{console.warn(arguments.callee.name+": Output div name is not set")}catch(e){}this.loadjQuery()}function loadjQuery(){var e=this,t=!1;if(void 0===window.jQuery)(r=document.createElement("script")).src=this.host+"/assets/js/jquery-1.12.4.min.js",r.onload=r.onreadystatechange=function(){var r=this.readyState;if(!(t||r&&"loaded"!==r&&"complete"!==r)){t=!0;try{e.loadjQueryHandler(!1)}catch(e){}}},(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(r);else if("1.12.4"!==window.jQuery.fn.jquery){var r=document.createElement("script");r.src=this.host+"/assets/js/jquery-1.12.4.min.js",r.onload=r.onreadystatechange=function(){var r=this.readyState;if(!(t||r&&"loaded"!==r&&"complete"!==r)){t=!0;try{e.loadjQueryHandler(!0)}catch(e){}}},(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(r)}else e.jQuery=window.jQuery,e.loadScripts(),e.loadJSON()}function loadjQueryHandler(e){e?(srv.jQuery=window.jQuery.noConflict(!0),this.loadScripts(),this.loadJSON()):(jQuery=window.jQuery.noConflict(!0),srv.jQuery=jQuery,this.loadScripts(),this.loadJSON())}function loadScripts(){var e=this.host+"/assets/surveys/"+this.version+"/js/"+"jquery.xdomainrequest.min.js";isIE&&this.appendScript(e,"#XDOMAINHELPER#",!1,"jQuery")}function loadJSON(){srv.log("getting survey data",!1,"info"),this.appendScript(this.url,"#MRscript#")}function generateHTML(e){var t=!1,r=current_block.properties,s=r.elements||!1,a=r.required,o=r.format?r.format:"",n=r.placeholder?r.placeholder:"",i=current_block.id,d=r.value,l=srv.jQuery("<span>").addClass("required-mark").html("*"),c="section_break"===e?"h3":"legend",u="section_break"===e?"section-title":"block-title";if(current_block.tooltip){t=srv.jQuery("<a>").addClass("tooltip").attr("href","#").css(touch_css).html(' <i class="fa fa-question"></i> <span>'+current_block.tooltip+"</span>");u+=" has-tooltip"}var p=srv.jQuery("<"+c+">").addClass(u).html(current_block.title).append(t);if(a&&p.append(l),$block=srv.jQuery("<div>").attr("id",i).addClass("control-group question").append(p),"input"===e)F=srv.jQuery("<input>").attr("id",e+"_"+i).attr("type","text").addClass(o).prop("placeholder",n).css(touch_css).val(d),a&&F.addClass("req"),iOSFix()&&F.on("focus",function(e){if(!srv.outer_modal){srv.jQuery(this).offset().top;srv.callParentWindow({fn:'(function(){srv.jQuery("#surveyWindowWrap").css({"position":"absolute","top":srv.jQuery(document).scrollTop(), "bottom":"auto"})})'})}}).on("blur",function(e){srv.outer_modal||srv.callParentWindow({fn:'(function(){srv.jQuery("#surveyWindowWrap").css({"position":"fixed","top":"0px", "bottom":"0px"})})'})}),$block.append(F);else if("textarea"===e)F=srv.jQuery("<textarea>").attr("id",e+"_"+i).attr("type","text").addClass(o).prop("placeholder",n).css(touch_css).html(d),iOSFix()&&F.on("focus",function(e){if(!srv.outer_modal){srv.jQuery(this).offset().top;srv.callParentWindow({fn:'(function(){srv.jQuery("#surveyWindowWrap").css({"position":"absolute","top":srv.jQuery(document).scrollTop(), "bottom":"auto"})})'})}}).on("blur",function(e){srv.outer_modal||srv.callParentWindow({fn:'(function(){srv.jQuery("#surveyWindowWrap").css({"position":"fixed","top":"0px", "bottom":"0px"})})'})}),a&&F.addClass("req"),$block.append(F);else if("select"===e){F=srv.jQuery("<select>").attr("id",e+"_"+i),a&&F.addClass("req"),""!=n&&(F.attr("data-placeholder","true"),$placeholder=srv.jQuery("<option>").attr("class","option_placeholder").attr("disabled",!0).prop("selected",!0).val("").css(touch_css).html(n),F.append($placeholder));for(var v in s)"function"!=typeof(g=s[v])&&(be=srv.jQuery("<option>").attr("id","option_"+i+"_"+v).val(g.label).css(touch_css).html(g.label),r.selected==v&&be.prop("selected",!0),F.append(be));$block.append(F)}else if(["checkbox","radio","category","gcr"].indexOf(e)>-1){var f="radio"===e?"rdo_":"chk_",m="category"===e||"gcr"===e?"radio":e,h={},y=!1;F=srv.jQuery("<div>");for(var v in s){var g=s[v],b=!1,_=i+"_"+v;if("function"!=typeof g){if(g.icon)b=srv.jQuery("<i>").addClass(g.icon);var j=g.value||g.label,Q=srv.jQuery("<input>").attr("type",m).attr("id",e+"_"+_).attr("name",e+"Group_"+i).on("click",function(){srv.setValue(this,e+"_"+i,"radio"!==m)}).css(touch_css).val(j);isActive(v,current_block)&&(Q.prop("checked","checked"),h[f+v]=g.label,0,y=!0);var k=srv.jQuery("<label>").attr("id","label_"+_).attr("for",e+"_"+_).addClass(e+" inline").append(b).css(touch_css).append(" "+g.label),w=srv.jQuery("<div>").addClass(e+"-wrapper").append(Q).append(k);1==r.show_as_buttons&&(w.addClass("button"),F.addClass("button-container")),F.append(w)}}S=y?JSON.stringify(h):"";L=srv.jQuery("<input>").attr("type","hidden").attr("id",e+"_"+i).on("blur",function(){showError(srv.jQuery(this),MS.validateField(this))}).val(S),a&&L.addClass("req"),$block.addClass("clearfix").append(F).append(L).append('<p class="clearfix"></p>')}else if("rating"===e){I=srv.jQuery("<div>").addClass("choice-row");if("numeric"==r.type){for(var C=r.includeZero?0:1,S=r.checked&&"number"==typeof r.checked[0]?r.checked[0]:"",v=C;v<parseInt(r.scale)+1;v++){var _=i+"_"+v,x=srv.jQuery("<input>").attr("type","radio").attr("id","rating_"+_).attr("name","radioGroup_"+i).on("click",function(){srv.setValue(this,e+"_"+i)}).css(touch_css).val(v);r.checked&&r.checked[0]==v&&x.prop("checked",!0);var M=srv.jQuery("<label>").attr("id","label_"+_).attr("for","rating_"+_).css(touch_css).html(v),E=srv.jQuery("<div>").addClass("rating-choice").append(x).append(M);I.append(E)}F=srv.jQuery("<div>").addClass("rating-group numeric").append('<span class="rating-prefix"></span>').append(I).append('<span class="rating-suffix"></span>')}else if("bar"==r.type){for(var S="",v=1;v<6;v++){if(1==v)T="--";else if(2==v)T="-";else if(3==v)T="0";else if(4==v)T="+";else if(5==v)var T="++";var _=i+"_"+v,x=srv.jQuery("<input>").attr("type","radio").attr("id","rating_"+_).attr("name","radioGroup_"+i).on("click",function(){srv.setValue(this,e+"_"+i)}).css(touch_css).val(v),M=srv.jQuery("<label>").attr("id","label_"+_).attr("for","rating_"+_).css(touch_css).html("<span>"+T+"</span>"),E=srv.jQuery("<div>").addClass("rating-choice").append(x).append(M);I.append(E)}F=srv.jQuery("<div>").addClass("rating-group bar").append('<span class="rating-prefix"></span>').append(I).append('<span class="rating-suffix"></span>')}else if("emoji"==r.type){var $=["angry","sad","neutral","happy","extra-happy"];for(var P in $){var v=Number(P)+1,_=i+"_"+v,x=srv.jQuery("<input>").attr("type","radio").attr("id","rating_"+_).attr("name","radioGroup_"+i).on("click",function(){srv.setValue(this,e+"_"+i)}).css(touch_css);r.labelsAsValue?x.val(r.emoji[v].label):x.val(v);M=srv.jQuery("<label>").attr("id","label_"+_).attr("for","rating_"+_).css(touch_css);if(r.showCaptions&&M.attr("data-label",r.emoji[v].label),supportsSvg())!function(e,t){srv.jQuery.ajax({url:"https://"+srv.domain+"/assets/img/surveys/emoji/"+t+".svg",type:"get",dataType:"text"}).done(function(r){e.addClass("emoji-"+t).html(r)})}(M,$[P]);else srv.jQuery("<img>").attr({src:"https://"+srv.domain+"/assets/img/surveys/emoji/"+$[P]+".png",height:"100%",width:"100%"}).appendTo(M);E=srv.jQuery("<div>").addClass("rating-choice").append(x).append(M);I.append(E)}F=srv.jQuery("<div>").addClass("rating-group emoji").append('<span class="rating-prefix"></span>').append(I).append('<span class="rating-suffix"></span>'),r.showCaptions&&F.addClass("show-labels")}else{A=r.checked;S="";for(var v in s)if("function"!=typeof(g=s[v])){var W=r.labelsAsValue&&""!==g.label?g.label:v,E=srv.jQuery("<input>").attr("type","radio").attr("id","Jrating").attr("name","Jrating").prop("title",g.label).css(touch_css).val(W);A&&A[0]==v&&(E.attr("checked","checked"),S=A[0]),I.append(E)}F=srv.jQuery("<div>").attr("id","star_rating_"+i).addClass("rating-group stars").append('<span class="rating-prefix"></span>').append(I).append('<span class="rating-suffix"></span>');var N=function(){var e=srv.jQuery("#rating_"+i);MS.validateField(e[0]),enableNext()},O={type:"rating",block_id:i,showCaptions:!!r.showCaptions,callback:N};srv.jQuery(document).ready(setTimeout(function(){srv.makeStars(F,O)},0))}L=srv.jQuery("<input>").attr("type","hidden").attr("id","rating_"+i).val(S),a&&L.addClass("req"),$block.append(L).append(F)}else if("nps"===e){for(var S="",q=srv.jQuery("<div>").addClass("choice-row"),v=0;v<11;v++){var _=i+"_"+v,Q=srv.jQuery("<input>").attr("type","radio").attr("id","nps_"+_).attr("name","radioGroup_"+i).on("click",function(){srv.setValue(this,e+"_"+i)}).css(touch_css).val(v);isActive(v,current_block)&&(Q.prop("checked","checked"),S=v);var k=srv.jQuery("<label>").attr("for","nps_"+_).attr("id","label_"+_).css(touch_css).html(v),B=srv.jQuery("<div>").addClass("nps-choice").append(Q).append(k);q.append(B)}var F=srv.jQuery("<div>").addClass("rating-group nps-group").append(q),L=srv.jQuery("<input>").attr("type","hidden").attr("id",e+"_"+i).on("click",function(){showError(srv.jQuery(this),MS.validateField(this))}).val(S);a&&L.addClass("req"),$block.append(F).append(L)}else if("ces"===e){var A=r.checked,S="",I=srv.jQuery("<div>").addClass("choice-row");for(var v in s)if("function"!=typeof(g=s[v])){checked=!1,A&&A[0]==v&&(checked=!0,S=A[0]);E=srv.jQuery("<input>").attr("type","radio").attr("id","Jrating").attr("name","Jrating").prop("title",g.label).css(touch_css).val(v);checked&&E.attr("checked",checked),I.append(E)}var N=function(){var e=srv.jQuery("#ces_"+i);MS.validateField(e[0]),enableNext()},O={type:"ces",block_id:i,showCaptions:!!r.showCaptions,callback:N};F=srv.jQuery("<div>").attr("id","ces_rating_"+i).addClass("rating-group ces").append('<span class="ces-prefix"></span>').append(I).append('<span class="ces-suffix"></span>'),srv.jQuery(document).ready(setTimeout(function(){srv.makeStars(F,O)},0)),L=srv.jQuery("<input>").attr("type","hidden").attr("id","ces_"+i).val(S),a&&L.addClass("req"),$block.append(F).append(L)}else if("section_break"===e)F=srv.jQuery("<div>").attr("id","section_description_"+i).addClass("section-description").html(r.description),$block.addClass("section").append(F);else if("matrix"===e){var H=r.values,R=r.weights,V=srv.jQuery("<th>").addClass("matrix-subject-label"),z=srv.jQuery("<tr>").append(V),D=srv.jQuery("<thead>").append(z),J=srv.jQuery("<tbody>");for(var U in H)if("function"!=typeof H[U]){var G=srv.jQuery("<th>").addClass("matrix-answer-label").html("<div><span>"+H[U].label+"</span></div>");z.append(G)}z.append('<th class="matrix-spacer"></th>');for(var Y in R)if("function"!=typeof R[Y]){var X=srv.jQuery("<th>").addClass("matrix-answer-label").html("<div><span>"+R[Y].label+"</span></div>");z.append(X)}for(var v in s)if("function"!=typeof(g=s[v])){de=srv.jQuery("<td>").addClass("matrix-subject").html(g.label);le=srv.jQuery("<tr>").append(de);L=srv.jQuery("<input>").attr("type","hidden").attr("id","matrix_"+i+"_"+v).on("blur",function(){showError(srv.jQuery(this),MS.validateField(this))});a&&L.addClass("req");for(var U in H)if("function"!=typeof H[U]){var K=srv.jQuery("<input>").attr("type","radio").attr("name","matrix_"+i+"_"+v+"_value").attr("id","matrix_"+i+"_"+v+"_value_"+U).attr("title",H[U].label).on("click",function(){setMatrix(this)}).css(touch_css).val(H[U].label),Z=srv.jQuery("<label>").attr("for","matrix_"+i+"_"+v+"_value_"+U).css(touch_css),ee=srv.jQuery("<div>").addClass("matrix-answer-inner").append(K).append(Z),te=srv.jQuery("<td>").addClass("matrix-answer").append(ee);le.append(te)}le.append('<td class="matrix-spacer"></td>');for(var Y in R)if("function"!=typeof R[Y]){var re=srv.jQuery("<input>").attr("type","radio").attr("name","matrix_"+i+"_"+v+"_weight").attr("id","matrix_"+i+"_"+v+"_weight_"+Y).attr("title",R[Y].label).on("click",function(){setMatrix(this)}).css(touch_css).val(R[Y].label),se=srv.jQuery("<label>").attr("for","matrix_"+i+"_"+v+"_weight_"+Y).css(touch_css),ae=srv.jQuery("<div>").addClass("matrix-answer-inner").append(re).append(se),oe=srv.jQuery("<td>").addClass("matrix-answer").append(ae);le.append(oe)}le.append(L),J.append(le)}var F=srv.jQuery("<div>").attr("id","matrix_"+i).addClass("matrix-group"),ne=srv.jQuery("<table>").addClass("table table-striped matrix-table").append(D).append(J);F.append(ne),$block.append(F)}else if("likert"===e){var H=r.values,V=srv.jQuery("<th>").addClass("likert-subject-label"),z=srv.jQuery("<tr>").append(V),D=srv.jQuery("<thead>").append(z),J=srv.jQuery("<tbody>");for(var U in H)if("function"!=typeof H[U]){var ie=srv.jQuery("<th>").addClass("likert-answer-label").html("<div><span>"+H[U].label+"</span></div>");z.append(ie)}for(var v in s)if("function"!=typeof(g=s[v])){var de=srv.jQuery("<td>").addClass("likert-subject").html(g.label),L=srv.jQuery("<input>").attr("type","hidden").attr("id","likert_"+i+"_"+v).on("blur",function(){showError(srv.jQuery(this),MS.validateField(this))});a&&L.addClass("req");var le=srv.jQuery("<tr>").append(de);for(var U in H){var j=H[U],ce=srv.jQuery("<input>").attr("type","radio").attr("name","likert_"+i+"_"+v).attr("id","likert_"+i+"_"+v+"_rdo_"+U).attr("title",j.label).on("click",function(){setLikert(this)}).css(touch_css).val(j.label),ue=srv.jQuery("<label>").attr("for","likert_"+i+"_"+v+"_rdo_"+U).css(touch_css),pe=srv.jQuery("<div>").addClass("likert-answer-inner").append(ce).append(ue);$cell=srv.jQuery("<td>").addClass("likert-answer").append(pe),le.append($cell)}le.append(L),J.append(le)}var F=srv.jQuery("<div>").attr("id","likert_"+i).addClass("likert-group"),ne=srv.jQuery("<table>").addClass("table table-striped likert-table").append(D).append(J);F.append(ne),$block.append(F)}else if("contact"===e){var ve=srv.jQuery("<div>").addClass("contact-wrapper");if(s.name.show){var fe=srv.jQuery("<div>").addClass("name-wrapper");if(s.title.show){var me=srv.jQuery("<select>").attr("id","contact_"+i+"_title").attr("data-contact",!0).addClass("span2").css(touch_css),he=Object.keys(s.title.options)[0];""!==s.title.options[he]&&(s.title.options[0]=""),s.title.required&&(me.addClass("req"),p.append(l));for(var ye in s.title.options){var ge=s.title.options[ye],be=srv.jQuery("<option>").val(ge).html(ge);me.append(be)}me=srv.jQuery("<div>").addClass("title").append(me);fe.append(me)}if(s.name.combine)name_placeholder=s.name.placeholder||"";else{var _e=srv.jQuery("<input>").attr("id","contact_"+i+"_firstname").attr("data-contact",!0).attr("type","text").attr("placeholder",s.name.subelements.firstname.placeholder||"").css(touch_css);s.name.required&&_e.addClass("req"),_e=srv.jQuery("<div>").append(_e),fe.append(_e),name_placeholder=s.name.subelements.lastname.placeholder||""}var je=srv.jQuery("<input>").attr("id","contact_"+i+"_name").attr("data-contact",!0).attr("type","text").attr("placeholder",name_placeholder).css(touch_css);s.name.required&&(je.addClass("req"),p.append(l)),je=srv.jQuery("<div>").append(je),fe.append(je)}if(s.email.show){var Qe=srv.jQuery("<input>").attr("id","contact_"+i+"_email").attr("type","text").attr("data-contact",!0).attr("placeholder",s.email.placeholder||"").addClass("email").css(touch_css);s.email.required&&Qe.addClass("req"),Qe=srv.jQuery("<div>").append(Qe);var ke=srv.jQuery("<div>").addClass("email-wrapper").append(Qe)}if(s.phone.show){var we=srv.jQuery("<input>").attr("id","contact_"+i+"_phone").attr("type","text").attr("data-contact",!0).attr("placeholder",s.phone.placeholder||"").addClass("phone").css(touch_css);if(s.phone.required&&we.addClass("req"),s.phone2.show){var Ce=srv.jQuery("<input>").attr("id","contact_"+i+"_phone2").attr("type","text").attr("data-contact",!0).attr("placeholder",s.phone2.placeholder||"").addClass("phone").css(touch_css);s.phone2.required&&Ce.addClass("req"),Ce=srv.jQuery("<div>").append(Ce)}we=srv.jQuery("<div>").append(we);var Se=srv.jQuery("<div>").addClass("phone-wrapper").append(we).append(Ce)}ve.append(fe).append(ke).append(Se),$block.append(ve)}else if("screenshot"===e){F=jQuery("<div>").attr("id","screenshot_element_"+i).addClass("section-screenshot").html('<i class="fa fa-camera"></i>').on("click",function(e){e.preventDefault(),srv.outer_modal?setTimeout(function(){srv.initCapture({embedded:!0,block_id:i})}):setTimeout(function(){srv.callParentWindow({fn:"srv.initCapture",data:{block_id:i,supportsPointerEvents:supportsPointerEvents()}})})});srv.jQuery("<div>").addClass("remove-capture").html('<i class="fa fa-times"></i>').appendTo(F),srv.jQuery("<div>").addClass("detect-capture").html('<i class="fa fa-check"></i>').appendTo(F);$block.addClass("section").append(F),1==r.bottomScreen&&($block.addClass("absolute"),t&&F.addClass("tooltip").append('<span class="tooltip">'+current_block.tooltip+"</span>"),a&&F.append(l));srv.jQuery("<input>").attr({type:"hidden",id:"dom_"+i}).prependTo($block),srv.jQuery("<input>").attr({type:"hidden",id:"selector_"+i}).prependTo($block);var xe=srv.jQuery("<input>").attr({type:"hidden",id:"screenshot_"+i}).on("blur",function(){showError(srv.jQuery(this),MS.validateField(this))}).prependTo($block);a&&xe.addClass("req")}else if("link"===e){var Me=current_block.properties.hyperlinkprotocol||"",Ee=current_block.properties.hyperlinkhref||"",Te=current_block.properties.hyperlinktext||"";Te=Te.replace("/*",'<a href="'+Me+Ee+'" target="_blank">').replace("*/","</a>"),F=Te,$block.append(F)}else if("website_data"===e){for(var v in s){var $e=s[v],Pe=e+"_"+$e.type+"_"+i+"_"+v;Pe=Pe.replace(/\W/g,"");srv.jQuery("<input>").attr({type:"hidden",id:Pe,name:Pe}).appendTo($block);if(srv.outer_modal)fetchVariable({type:$e.type,value:$e.value,hidden_id:Pe,embedded:!0});else{var We={type:$e.type,value:encodeURIComponent($e.value),hidden_id:Pe};We=JSON.stringify(We),srv.callParentWindow({fn:"srv.fetchVariable",data:We})}}$block.css("display","none")}else $block=srv.jQuery("<div>").html("[unknown type]");return $block}function buildForm(){srv.jQuery(document).one("touchstart",function(){user_touching=!0}),supportsPointerEvents(!0);var e=srv.jQuery("#"+this.div_name).css({display:"none",opacity:0}),t=!1;if("undefined"!=typeof survey_properties){var r=!1,s=!1,a=!1,o=srv.jQuery("<div>").attr("id","lastPage").addClass("last-page").css({"min-height":"100px",display:"none"}).html(survey_properties.exit_content),n=srv.jQuery("<div>").addClass("completed-anim").append('<i class="fa fa-check"></i>');o.prepend(n);var i=srv.jQuery("<div>");if(!this.outer_modal){var r=srv.jQuery("<div>").attr("id","surveyHead"),s=srv.jQuery("<div>").attr("id","surveyFoot");if(survey_properties.footer&&s.html("<p>"+survey_properties.footer+"</p>"),""!=survey_properties.logo)var d=srv.jQuery("<img>").attr("id","customerLogo").attr("src",survey_properties.logo);var l=srv.jQuery("<div>").attr("id","surveyTitle").addClass("srv-title main-title").html("<h1>"+survey_properties.title+"</h1>");r.append(d).append(l)}$page=srv.jQuery("<div>").attr("id","page1"),srv.jQuery(block_layout).each(function(e,t){if("object"==typeof(current_block=block_params[t])){if("page_break"!==current_block.typeName)1==current_block.properties.bottomScreen?(a=jQuery(srv.generateHTML(current_block.typeName)),current_block.properties.hide_on_init&&hide_on_init.push(current_block.typeName+"_"+current_block.id)):($block=jQuery(srv.generateHTML(current_block.typeName)),current_block.properties.hide_on_init&&hide_on_init.push(current_block.typeName+"_"+current_block.id),$page.append($block));else{srv.page_count++;var r=current_block.properties,s=srv.jQuery("<div>").addClass("form-actions");s.append("<span>"+current_block.title+"</span>"),1!=r.isFirst&&""!==srv.jQuery.trim(r.prevLabel)&&(f=srv.jQuery("<button>").attr("id","btn_prev_"+current_block.id).addClass("btn btn-previous pull-left").on("click",function(){srv.prevPage()}).css(touch_css).html(r.prevLabel),s.append(f)),$next_btn=srv.jQuery("<button>").attr("id","btn_next_"+current_block.id).addClass("btn btn-next pull-right").on("click",function(){srv.nextPage()}).css(touch_css).html(r.nextLabel),void 0!==r.isAction&&1==r.isAction&&$next_btn.addClass("btn-primary btn-submit"),s.append($next_btn),$page.append(s),i.append($page),$page=srv.jQuery("<div>").attr("id","page"+srv.page_count).addClass("page-break").css("display","none")}updateQuestionCount(current_block)}});var c=this.getLanguage("btnSubmitText"),u=srv.jQuery("<button>").attr("id","surveySubmitBtn").addClass("btn btn-primary btn-submit pull-right").on("click",function(){srv.submitSurvey()}).css(touch_css).html(c),p=srv.jQuery("<div>").addClass("form-actions");if(this.page_count>1){var v=this.getLanguage("btnLastBackText"),f=srv.jQuery("<button>").addClass("btn btn-previous").on("click",function(){srv.prevPage()}).html(v);p.append(f)}if(p.append(u),$page.append(p),i.append($page),this.show_progress)var m=srv.jQuery("<div>").attr("id","progress").addClass("progress").append('<div id="progressBar" class="bar" style="width: 0%;"></div>');y=srv.jQuery("<div>").append(r).append(m).append(i).append(o).append(s);a&&y.append(a),initBlockRules(),initSurveyRules(),resizeListener(getParameterByName("parent",document.location.href),"surveyContent"),t=!0}else if(this.outer_modal){if(srv.slider&&srv.slider.type||srv.button.hide||(y=addButton()),isPreview&&(srv.jQuery("#surveyPreviewButtonValue").html(!srv.button||srv.button.hide?"Yes":"No"),!srv.button||srv.button.hide)){var h=srv.jQuery("<button>").addClass("force-modal-btn").html("Force open").css(touch_css).on("click",function(){srv.openModal(!0)});srv.jQuery("#surveyPreviewButtonValue").append(h)}}else var y=srv.jQuery("<div>").addClass("alert alert-error").html("Error loading survey");e.append(y);for(var g in survey_text.errors)error_messages[g]=survey_text.errors[g];srv.jQuery("input[type=text], textarea").keyup(function(){enableNext()}),srv.jQuery("input[type=checkbox], input[type=radio]").click(function(){enableNext()}),srv.jQuery("input[type=text], textarea").blur(function(){showError(srv.jQuery(this),MS.validateField(this))}),srv.jQuery("select").change(function(){showError(srv.jQuery(this),MS.validateField(this)),enableNext()}),"undefined"!=typeof survey_properties&&"disable"==survey_properties.advanced.next_button_behaviour?srv.jQuery(".btn-next, #surveySubmitBtn").prop("disabled",!0):"undefined"!=typeof survey_properties&&"hide"==survey_properties.advanced.next_button_behaviour&&srv.jQuery(".btn-next, #surveySubmitBtn").hide();for(var b in hide_on_init)hideBlock(hide_on_init[b]);if(e.css("display","none").removeClass("sd-loading").addClass("sd-loaded"),initPostMessage(),getMeta(),isPreview&&"-"==srv.jQuery("#surveyPreviewMessageContent").html()&&srv.jQuery("#surveyPreviewMessageContent").html("All good!"),srv.outer_modal||MS.hammerTime(),e.find("select").length){var _=e.find("select");srv.niceSelect(_),_.each(function(e,t){var r=srv.jQuery(t);r.find("option:eq(0)").hasClass("option_placeholder")&&""===r.find("option:eq(0)").val()&&(r.find("option:eq(0)").remove(),r.val(""))})}setTimeout(function(){enableNext()},250),setTimeout(function(){e.animate({opacity:1},{duration:300,display:"block",complete:function(){e.addClass("allow-button"),srv.jQuery("#branding").addClass("anim")}})},500),srv.slider&&"slide"===srv.slider.type&&(e.addClass("mopinion-slide"),srv.outer_modal&&srv.preloadSlider(),srv.outer_modal||e.closest("#surveyBody").addClass("mopinion-slide")),t&&srv.outer_modal?(EventInitializer("form_loaded"),srv.triggerEvent("loaded")):t&&!srv.outer_modal&&(srv.callParentWindow({fn:"srv.initEvent",data:"form_loaded"}),srv.callParentWindow({fn:"srv.triggerEvent",data:"loaded"}))}function EventHandler(e,t){srv.eventsHandlers[e].push(t)}function EventInitializer(e){for(var t in srv.eventsHandlers[e]){var r=srv.eventsHandlers[e][t];"function"==typeof r&&setTimeout(r,350)}}function triggerEvent(e,t){t=t||document;try{var r=document.createEvent("Event");r.initEvent("mopinion."+e,!0,!0),t.dispatchEvent(r)}catch(r){}}function appendScript(e,t,r,s,a){var o=document.getElementsByTagName("head")[0],n=document.getElementById(t),i=!1;n&&o.removeChild(n);var d=document.createElement("script");if(d.type="text/javascript",d.id=t,d.src=e,r)for(var l in r)d[l]=r[l];if(s)var c=window.setInterval(function(){srv.log("waiting for "+s+" to load"),"function"==typeof window[s]&&(srv.log(s+" loaded"),i=!0,window.clearInterval(c),o.appendChild(d))},10);else o.appendChild(d);if("function"==typeof a){var u=!1;d.onload=d.onreadystatechange=function(){var e=this;if(!(u||e.readyState&&"loaded"!==e.readyState&&"complete"!==e.readyState)){u=!0;try{a()}catch(e){}}}}}function appendStyle(e,t){var r=document.getElementsByTagName("head")[0],s=document.getElementById(t);s&&r.removeChild(s);var a=document.createElement("link");a.type="text/css",a.rel="stylesheet",a.id=t,a.href=e,r.appendChild(a)}function log(e,t,r){if(r&&"log"!=r){if("warn"==r){if(this.show_log||!0===t)try{console.warn(e)}catch(e){}}else if("info"==r){if(this.show_log||!0===t)try{console.info(e)}catch(e){}}else if("error"==r)throw new Error(e)}else if(this.show_log||!0===t)try{console.log(e)}catch(e){}}function prevPage(e){console.log("prevPage():"),console.log("page_nr",e),this.page_history[this.current_page]?(srv.log("getting page from history"),this.prev_page=this.page_history[this.current_page]):srv.log("natural flow"),$curr_page_div=srv.jQuery("#page"+this.current_page),$new_page_div=srv.jQuery("#page"+this.prev_page),this.next_page=this.current_page,$new_page_div.css("display","block"),$curr_page_div.css("display","none"),this.current_page=this.prev_page,this.prev_page--,console.log("current page is now:",this.current_page),console.log("prev page is now:",this.prev_page),console.log("next page is now:",this.next_page),updateProgress(),updateHeader()}function nextPage(e){if(lock_submit)return!1;var t=page_map[this.current_page];if(MS.validateAll(t,showError)){if(scroll_top=0,this.prev_page=this.current_page,$prev_page_div=srv.jQuery("#page"+this.prev_page),this.next_page&&(e=this.next_page,this.page_history[this.next_page]=this.current_page),e?this.current_page=e:this.current_page++,-1==e)srv.jQuery("#lastPage").css("display","block").find(".completed-anim").addClass("do-anim"),srv.jQuery("#surveyTitle h1").text(this.getLanguage("lastPageTitle")),srv.jQuery("#surveyDescription").css("display","none"),srv.jQuery("#lastPage").parent().find(".control-group").length&&srv.jQuery("#lastPage").parent().find(".control-group").css("display","none");else{srv.jQuery("#page"+this.current_page).css("display","block");this.send(!1)}$prev_page_div.css("display","none"),this.next_page=!1}else srv.log(error_messages.deflt,!1,"warn"),first_error=srv.jQuery("#"+MS.errors[0]).parent(),scroll_top=first_error.offset().top;updateProgress(),updateHeader(),scrollToSurveyElement(scroll_top),enableNext()}function updateQuestionCount(e){"matrix"==e.typeName||"likert"==e.typeName?srv.question_count=srv.question_count+Object.keys(e.properties.elements).length:"section_break"!=e.typeName&&"page_break"!=e.typeName&&srv.question_count++}function updateHeader(){srv.current_page>1||srv.current_page<0?srv.jQuery("#surveyDescription").css("display","none"):(srv.jQuery("#surveyTitle").css("display","block"),srv.jQuery("#surveyDescription").css("display","block"))}function updateProgress(){var e=0,t=0;if(-1==srv.current_page)e=100,srv.jQuery("#progress").remove();else{for(var r=1;r<srv.current_page;r++)t+=page_map[r].length;e=t*(100/srv.question_count)}srv.jQuery("#progress").children(".bar").css("width",e+"%")}function setValue(e,t,r){var s=srv.jQuery("#"+t);if($id_nr=t.replace(e.type+"_",""),"checkbox"==e.type){$new_value={};s.val().split(",");srv.jQuery("input[name="+e.name+"]:checked").each(function(e,t){var r=t.id.split("_"),s=r[r.length-1];t.value&&($new_value["ch_"+s]=t.value)}),s.val(JSON.stringify($new_value)),"{}"==s.val()&&s.val("")}else if(r){var a=e.id.split("_"),o=a[a.length-1];$new_value={},$new_value["rdo_"+o]=e.value,s.val(JSON.stringify($new_value))}else s.val(e.value);s.val(s.val()).trigger("change"),showError(s,{state:!0}),MS.unsetError(s)}function send(e){setLock();var t=function(e){var t=e.verbose||!1,r="Failed to send survey!";srv.log(e),t&&(r+="\n\nCode:"+e.code+"\nMessage:"+e.error),alert(r),clearLock(),srv.jQuery("#surveySubmitBtn").removeClass("is-submitting").html(srv.jQuery("#surveySubmitBtn").data("buttonContent")).prop("disabled",!1)},r={feedback:[]};srv.jQuery(survey_send_options.data).each(function(e,t){if(t){var s=t.by_name?srv.jQuery('input[name="'+t.field+'"]:checked'):srv.jQuery("#"+t.field),a="checkbox"==s.attr("type")?s.prop("checked"):s.val();r.feedback.push({label:t.label,value:a,type:t.type})}}),!1!==survey_send_options.force_customer&&r.feedback.push({value:survey_send_options.force_customer.value,type:"customer",label:survey_send_options.force_customer.label}),r.feedback.push({value:navigator.userAgent,type:"agent",label:"User Agent"});var s=getParameterByName("parent",document.location);r.feedback.push({value:s||document.location.href,type:"url",label:"url"}),r.feedback.push({value:document_title,type:"category",label:"Page title"}),r.feedback.push({value:1,type:"role",label:"Role"}),r.feedback.push({value:survey_properties.name,type:"category",label:"Survey"}),r.feedback.push({value:window_viewport,type:"viewport",label:"Viewport"}),"insert"!==sendMode&&r.feedback.push({value:followUpId,type:"id",label:"Survey ID"});var a={token:survey_send_options.token,domain:survey_send_options.domain,surveyId:survey_properties.id,ip:customerIP||0,data:r,mode:sendMode};survey_send_options.preview?(srv.log("Preview mode, not sending"),clearLock()):this.request("send",a,function(r){if(srv.log("Api Response:\n Code:"+r.code+"\n"+r.msg,!1,"info"),lock_submit=!1,clearLock(),r&&200==r.code){if(r.id&&(followUpId=r.id,sendMode="upsert"),e){srv.outer_modal?setCookies("sent"):srv.callParentWindow({fn:"srv.setCookies",data:"sent"});var s={timeout:survey_properties.timeout};survey_properties.notify&&survey_properties.notify.send&&(notify=survey_properties.notify,s.to=srv.jQuery("#"+survey_properties.notification_email).val(),s.subject=notify.subject||"",s.sender=notify.sender||"",s.message=notify.message||"",srv.jQuery("#lastPage").html(survey_properties.exit_content.replace("%email%",s.to)),srv.jQuery("#lastPage").prepend('<div class="completed-anim do-anim"><i class="fa fa-check"></i></div>')),survey_properties.modal&&srv.jQuery("#lastPage").append('<div id="autoClose" class="countdown muted" style="position:absolute; bottom:40px; right:20px;">window closes in <span id="countdown"></span> seconds</div>'),postSumbit(s),srv.outer_modal?(srv.triggerEvent("feedback_sent"),srv.clearCaptureEvents()):(srv.callParentWindow({fn:"srv.triggerEvent",data:"feedback_sent"}),srv.callParentWindow({fn:"srv.clearCaptureEvents"})),srv.slider&&"slide"===srv.slider.type&&setTimeout(function(){srv.callParentWindow({fn:"srv.closeSlider"}),setTimeout(location.reload(),750)},5e3)}}else t(r)},t,!1)}function request(e,t,r,s,a){s||(s=function(){srv.log("Error processing request",!0,"warn")});var o=a?"//"+srv.domain:srv.host;srv.jQuery.ajax({async:!0,url:o+"/survey/public/"+e,dataType:"json",type:"POST",data:t,error:s,success:r})}function submitSurvey(){if(lock_submit)return!1;srv.jQuery("#surveySubmitBtn").prop("disabled",!0);var e=page_map[this.current_page];MS.validateAll(e,showError)?(srv.jQuery("#surveySubmitBtn").data("buttonContent",srv.jQuery("#surveySubmitBtn").html()).html('<i class="fa fa-refresh"></i>').addClass("is-submitting"),this.send(!0)):(srv.log(error_messages.deflt,!1,"warn"),srv.jQuery("#surveySubmitBtn").prop("disabled",!1),first_error=srv.jQuery("#"+MS.errors[0]).parent(),scroll_top=first_error.offset().top,scrollToSurveyElement(scroll_top))}function openModal(e,t){t||(t=srv.key);{if(!srv.slider||"slide"!==srv.slider.type){if(getCookie("MSopened")==t&&!e||modal_open){var r="Not opening, reason: ";modal_open?r+="Already open":getCookie("MSopened")==t&&(r+="Got a cookie, and not forced by user"),isPreview&&srv.jQuery("#surveyPreviewMessageContent").html(r),srv.log(r)}else{e&&srv.log("User forced opening of modal",!1,"info"),modalFirst=!0;var s=srv.jQuery("#"+srv.div_name),a=srv.jQuery("<div>").attr("id","surveyMask"),o=srv.jQuery("<div>").attr("id","surveyModalLoader").addClass("survey-modal-loader").append('<svg class="circular-spin" viewBox="25 25 50 50"><circle class="stroke-path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/></svg>'),n=(void 0!==document.documentMode&&document.documentMode,1==mpnndbg?"https://"+srv.domain:srv.host),i=1==mpnndbg?"debug=1":"",d=srv.jQuery("<div>").attr("id","surveyWindowWrap").css({position:"fixed",top:0,left:0,right:0,"z-index":2000000001,bottom:0,"overflow-y":"auto","-webkit-overflow-scrolling":"touch","min-height":"100%"}).on("click",function(){a.click()});handleIframeWidth(srv.jQuery("<iframe>").attr("id","surveyWindow").attr("src",n+"/survey/public/modal?"+i+"&key="+t+"&domain="+srv.domain+"&version="+srv.version+"&parent="+document.location).attr("frameBorder",!1).attr("allowTransparency",!0).css({border:"none","border-radius":"2px",position:"absolute",top:"50px",left:0,right:0,"margin-left":"auto","margin-right":"auto","max-width":"480px","z-index":2000000001,"margin-bottom":50,"box-shadow":"0 8px 17px 0 rgba(0,0,0,0.2)",opacity:0}).appendTo(d)),s.append(a).append(o),a.animate({opacity:.15},{complete:function(){srv.jQuery("html,body").addClass("mopinion-modal-active"),s.append(d),srv.triggerEvent("shown"),a.on("click",function(){srv.closeModal()}),modal_open=!0,setCookies("open"),srv.hideLoader()}}),srv.jQuery(window).on("resize orientationchange",handleIframeWidth)}return!0}srv.openSlider(e,t)}}function closeModal(){if(srv.slider&&"slide"===srv.slider.type)srv.closeSlider();else{var e=srv.jQuery("#surveyMask"),t=srv.jQuery("#surveyWindow"),r=srv.jQuery("#surveyWindowWrap");srv.jQuery(window).off("resize orientationchange",handleIframeWidth),srv.clearCaptureEvents(),t.animate({opacity:0,translateY:50},{duration:300,complete:function(){modalFirst=!1,r.remove(),e.animate({opacity:0},{duration:300,complete:function(){e.remove(),modal_dismissed=!0,modal_open=!1,srv.hideLoader(),srv.jQuery("html,body").removeClass("mopinion-modal-active"),srv.triggerEvent("hidden")}})}})}}function hideLoader(){srv.jQuery("#surveyModalLoader").fadeOut(500).promise().done(function(){srv.jQuery(this).remove()})}function setCookies(e){2==srv.cookie_level?path=document.location.href:1==srv.cookie_level?path=document.location.pathname:path="/";var t=srv.key;"open"===e?setCookie("MSopened",t,srv.cookie_expire,path,void 0,!1):"sent"===e&&setCookie("MSFeedbackSent",t,srv.cookie_expire,path,void 0,!1)}function setCookie(e,t,r,s,a,o){var n=new Date;n.setTime(n.getTime()),r&&(r=1e3*r*60*60*24);var i=new Date(n.getTime()+r);document.cookie=e+"="+escape(t)+(r?";expires="+i.toGMTString():"")+(s?";path="+s:"")+(a?";domain="+a:"")+(o?";secure":"")}function getCookie(e){var t,r,s,a=document.cookie.split(";");for(t=0;t<a.length;t++)if(r=a[t].substr(0,a[t].indexOf("=")),s=a[t].substr(a[t].indexOf("=")+1),(r=r.replace(/^\s+|\s+$/g,""))==e)return unescape(s)}function handleIframeWidth(e){var t,r=srv.jQuery(window).width();e=MS.isDOM(e)||MS.isDOM(e[0])?e:srv.jQuery("#surveyWindow"),r>1200?t="40%":r>992&&r<1201?t="45%":r<993&&r>768?t="50%":r<769&&r>544?t="70%":545>r&&(t="90%"),e.css({width:t})}function resizeListener(e,t){var r=srv,s=function(){return srv.jQuery(".modal-footer").outerHeight(!0)};resize_int=window.setInterval(function(){if(document.getElementById(t)){var e=document.getElementById(t).parentNode.offsetHeight;if(e!==r.form_height){var a=s();r.form_height=e;try{r.callParentWindow({fn:"srv.resizeForm",data:{height:r.form_height+a}})}catch(e){}}}else clearInterval(resize_int)},10)}function callParentWindow(e,t){t||(t=srv.getParameterByName("parent",document.location.href)||"*"),"function"==typeof window.postMessage&&(isIE&&(e=JSON.stringify(e)),parent.postMessage(e,t))}function callChildWindow(e,t){if(!t)var t=document.getElementById("surveyWindow");"function"==typeof window.postMessage&&(isIE&&(e=JSON.stringify(e)),t.contentWindow.postMessage(e,t.getAttribute("src")))}function initPostMessage(){var url_match;if(srv.outer_modal)var debug="undefined"!=typeof mpnndbg&&1==mpnndbg||!1,url_match=debug?"https://"+srv.domain:srv.host;else{var url_match=srv.getParameterByName("parent",document.location.href).split("/");url_match.length>3&&(url_match=url_match[0]+"//"+url_match[2])}var receiveMessage=function(event){if(event.data&&event.origin===url_match)if("object"==typeof event.data){if(event.data.fn){var fn=eval(event.data.fn),data=event.data.data;"function"==typeof fn&&fn(data)}}else try{var parsed=JSON.parse(event.data);if(parsed.fn){var fn=eval(parsed.fn),data=parsed.data;"function"==typeof fn&&fn(data)}}catch(e){var fn=eval(event.data.fn),data=event.data.data;"function"!=typeof fn||"string"!=typeof data&&void 0!==data||fn(data)}};void 0!==window.addEventListener?window.addEventListener("message",receiveMessage,!1):window.attachEvent("onmessage",receiveMessage)}function resizeForm(e){var t=document.getElementById("surveyWindow");modalFirst?setTimeout(function(){srv.jQuery(t).stop().animate({opacity:1,height:e.height},{duration:225,complete:function(){modalFirst=!1}})}):e.height&&(modalFirst||srv.jQuery(t).stop().animate({height:e.height+"px"},{duration:225,complete:function(){srv.log("Srv height set",!1,"info")}}))}function getLanguage(e,t){return"undefined"!=typeof survey_text&&void 0!==survey_text[e]?survey_text[e]:"["+e+"]"}function addButton(e,t){var r=srv.button,s=r.content||srv.getLanguage("btnOpenText"),a=r.style||"tab",o=r.position||"right",n=srv.jQuery("<i>").addClass("fa "+r.icon).css({marginRight:"10px"})||"";return srv.slider&&srv.slider.type?srv.jQuery("<button>").attr({type:"button",id:"openSliderButton"}).addClass("btn-open-slider").html('<i class="fa '+r.icon+'"></i>').on("click",function(){srv.jQuery("html").hasClass("mopinion-slider-active")?srv.closeSlider():srv.openSlider(!0,e)}):srv.jQuery("<button>").addClass("btn-open-survey btn btn-primary").addClass(a+" "+a+"-"+o).on("click",function(){srv.openModal(!0,e)}).css("visibility","hidden").css(touch_css).html(s).prepend(n)}function showButton(e){e||(e=srv.key),this.removeButton(),$button=this.addButton(e),srv.slider&&srv.slider.type?(e&&e!==srv.key&&(srv.key=e),srv.preloadSlider(e,!1,!0)):srv.jQuery("#"+srv.div_name).append($button),setTimeout(function(){srv.jQuery("#"+srv.div_name).addClass("allow-button")},0)}function removeButton(){srv.slider&&srv.slider.type?srv.jQuery("#surveyWindowWrap").remove():(srv.jQuery("#"+srv.div_name+" .btn-open-survey").remove(),srv.jQuery("#"+srv.div_name).removeClass("allow-button"))}function isActive(e,t){var r="select"===t.typeName?t.properties.selected:t.properties.checked;for(var s in r)if("function"!=typeof r[s]&&"function"!=typeof r[s]&&r[s]==e)return!0;return!1}function cleanArray(e){var t=[];for(var r in e)"function"!=typeof e[r]&&void 0!==e[r]&&t.push(e[r]);return t}function rand(){return("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6).toUpperCase()}function unsetRequirement(e){var t=srv.jQuery("#"+e);t.hasClass("req")&&(t.removeClass("error"),t.parent().removeClass("error"),-1==required_when_visible.indexOf(e)&&required_when_visible.push(e),delete MS.errors[MS.errors.indexOf(e)],MS.errors=cleanArray(MS.errors),t.removeClass("req"))}function setRequirement(e){var t=srv.jQuery("#"+e);required_when_visible.indexOf(e)>-1&&t.addClass("req")}function unhideBlock(e){if(e.indexOf("contact_")>-1?($block_elements=srv.jQuery('*[id^="'+e+'"]'),$block=$block_elements.closest(".contact-wrapper")):e.indexOf("matrix_")>-1||e.indexOf("likert_")>-1?($block_elements=srv.jQuery('input[type="hidden"][id^="'+e+'"]'),$block=srv.jQuery("#"+e)):$block=srv.jQuery("#"+e),$block){e.indexOf("section_break")>-1?($block=srv.jQuery("#"+e.split("_")[2]),$block.css("display","block")):$block.hasClass("contact-wrapper")||$block.hasClass("matrix-group")||$block.hasClass("likert-group")?$block_elements.each(function(e,t){setRequirement(t.id)}):setRequirement(e);try{$block.parent().css("display","block")}catch(t){srv.log("block:"+e+" not found")}}}function hideBlock(e,t,r){if("function"!=typeof e&&(e.indexOf("contact_")>-1?($block_elements=srv.jQuery('*[id^="'+e+'"]'),$block=$block_elements.closest(".contact-wrapper")):e.indexOf("matrix_")>-1||e.indexOf("likert_")>-1?($block_elements=srv.jQuery('input[type="hidden"][id^="'+e+'"]'),$block=srv.jQuery("#"+e)):$block=srv.jQuery("#"+e),$block))if(e.indexOf("section_break")>-1)$block=srv.jQuery("#"+e.split("_")[2]),$block.css("display","none");else{var s=$block.parent();s.css("display","none"),s.removeClass("error"),$block.removeClass("error"),$block.hasClass("contact-wrapper")||$block.hasClass("matrix-group")||$block.hasClass("likert-group")?$block_elements.each(function(e,s){if(unsetRequirement(s.id),t){var a=srv.jQuery(s);a.not(":checkbox,:radio").val(""),a.prop("checked",!1),a.is("select")&&srv.niceSelect(a,"update"),r&&a.trigger(r)}}):(unsetRequirement(e),t&&(s.find("input").not(":checkbox,:radio").val(""),s.find("input").prop("checked",!1),s.find(".ui-stars-star").removeClass("ui-stars-star-on"),"select"==e.split("_")[0]&&($block.val(""),srv.niceSelect($block,"update")),r&&$block.trigger(r)))}}function setPrefill(e,t,r){if($block=srv.jQuery("#"+e),$block){var s;"url_query"==r?s=getParameterByName(t,document.location.href):"cookie"==r?s=getCookie(t):r&&"fixed"!=r||(s=t),$block.val(decodeURIComponent(s)),""!==$block.val()&&$block.trigger("blur")}}function setNextPage(e){srv.next_page=parseInt(e);for(var t in srv.page_history)t==e||srv.page_history[t]==srv.current_page&&delete srv.page_history[t]}function showError(e,t){e instanceof jQuery==0&&(e=srv.jQuery(e));var r=e.parent(),s=e.attr("id");if("TR"==r[0].nodeName){var a=s.split("_"),o=a[0]+"_"+a[1],r=srv.jQuery("#"+o),s=o;t.code="required_multi",MS.unsetError(e),t.state?MS.unsetError(r):MS.setError(r)}else if(e.parents(".contact-wrapper")[0])r=e.parent();if(srv.jQuery("#"+s+"_error")[0]&&srv.jQuery("#"+s+"_error").remove(),!t.state&&-1!=MS.errors.indexOf(s)){var n=srv.jQuery("<div>").attr("id",s+"_error").addClass("alert alert-danger").html(t.code&&error_messages[t.code]?error_messages[t.code]:error_messages.deflt);r.append(n)}}function postSumbit(e){srv.nextPage(-1);getParameterByName("parent",document.location.href);if(e.to){var t={surveyKey:srv.key,email:e.to};srv.request("notify-user",t,function(e){srv.log(e)},function(){srv.log("Failed to send notification",!0,"error")},!0)}if(e.timeout>0){var r=e.timeout;srv.jQuery("#countdown").html(e.timeout/1e3);var s=setInterval(function(){r-=1e3,srv.jQuery("#countdown").html(r/1e3),r<=0&&(clearInterval(s),srv.callParentWindow({fn:"srv.closeModal"}))},1e3)}else srv.jQuery("#autoClose").remove()}function getParameterByName(e,t){e=e.replace(/[\[]/,"[").replace(/[\]]/,"]");var r=new RegExp("[?&]"+e+"=([^&#]*)").exec(t);return null==r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function setLikert(e){var t=srv.jQuery("#"+e.name);t.val(e.value),showError(t,{state:!0}),MS.unsetError(t)}function setMatrix(e){var t=e.name.split("_"),r=srv.jQuery('input[name="'+t[0]+"_"+t[1]+"_"+t[2]+'_value"]:checked').val(),s=srv.jQuery('input[name="'+t[0]+"_"+t[1]+"_"+t[2]+'_weight"]:checked').val(),a=srv.jQuery("#"+t[0]+"_"+t[1]+"_"+t[2]);if(r&&s){var o=JSON.stringify({value:r,weights:s});a.val(o),showError(a,{state:!0}),MS.unsetError(a)}}function initCapture(e){function t(t,r){if(srv.jQuery("#mopinion_dimmer_overlay").remove(),t)var s=t[0].getBoundingClientRect();var a=srv.jQuery("<div>").attr("id","mopinion_dimmer_overlay");e.embedded&&a.addClass("is-embedded");srv.jQuery("<div>").addClass("dimmer-border").appendTo(a);var o=srv.jQuery("<div>").addClass("dimmer-actions").appendTo(a);srv.jQuery("<div>").html(r?'<i class="fa fa-check" style="margin-right:10px"></i>'+srv.getLanguage("screenCaptureSelected"):(user_touching?'<i class="fa fa-hand-pointer-o" style="margin-right:10px"></i>':'<i class="fa fa-mouse-pointer" style="margin-right:10px"></i>')+srv.getLanguage("screenCaptureText")).appendTo(o),srv.jQuery("<div>").html("&times;").addClass("dimmer-cancel").on("click",function(t){t.stopPropagation(),setTimeout(function(){srv.clearCaptureEvents(),e.embedded?srv.clearCaptureValues({block_id:e.block_id}):(srv.showModalPostCapture(),srv.callChildWindow({fn:"srv.clearCaptureValues",data:{block_id:e.block_id}}))})}).appendTo(o);if(t){if(!e.embedded&&!0===e.supportsPointerEvents)srv.jQuery("<div>").css({position:"fixed",background:"rgba(0,0,0,.3)",top:0,height:s.top,left:0,right:0,pointerEvents:"none"}).appendTo(a),srv.jQuery("<div>").css({position:"fixed",background:"rgba(0,0,0,.3)",top:s.bottom,bottom:0,left:0,right:0,pointerEvents:"none"}).appendTo(a),srv.jQuery("<div>").css({position:"fixed",background:"rgba(0,0,0,.3)",top:s.top,height:s.height,left:0,width:s.left,pointerEvents:"none"}).appendTo(a),srv.jQuery("<div>").css({position:"fixed",background:"rgba(0,0,0,.3)",top:s.top,height:s.height,width:srv.jQuery(window).width()-s.right,right:0,pointerEvents:"none"}).appendTo(a);var n=srv.jQuery("<div>").addClass("dimmer-highlight").css({position:"fixed",top:s.top-3,left:s.left-3,height:s.height+6,width:s.width+6}).appendTo(a);if(user_touching&&!r)srv.jQuery("<button>").attr({type:"button"}).text(srv.getLanguage("screenCaptureTouchBtnText")).addClass("btn-select-touch").on("click",function(e){e.preventDefault(),e.stopPropagation(),srv.jQuery(this).trigger("click.mopinion_screencapture",{selected:!0})}).appendTo(n);r&&n.addClass("dimmer-selected"),srv.jQuery("body").append(a)}else{srv.jQuery("<div>").css({position:"fixed",background:"rgba(0,0,0,.3)",top:0,bottom:0,left:0,right:0,pointerEvents:"none"}).appendTo(a);var i=srv.jQuery("<div>").addClass("capture-hint").appendTo(a),d=srv.jQuery("<i>").appendTo(i);user_touching?d.addClass("fa fa-hand-pointer-o"):d.addClass("fa fa-mouse-pointer");srv.jQuery("<div>").text(srv.getLanguage("screenCaptureHint")).appendTo(i);srv.jQuery("body").append(a)}}var r;(e=e||{}).embedded||(srv.jQuery("html,body").removeClass("mopinion-modal-active"),srv.jQuery("#surveyWindowWrap, #surveyWindow, #surveyMask").addClass("screen-capture-active")),setTimeout(function(){srv.jQuery(document).on("mousemove.mopinion_screencapture",function(e){user_touching||t(srv.jQuery(e.target))}),srv.jQuery("*").on("click.mopinion_screencapture",function(s,a){if(s.preventDefault(),s.stopPropagation(),srv.jQuery(document).off("mousemove.mopinion_screencapture"),a||(r=s.target),srv.jQuery(window).off("scroll.mopinion_screencapture").on("scroll.mopinion_screencapture",function(e){!user_touching||a?t(srv.jQuery(r),!0):t(srv.jQuery(r))}),!user_touching||a&&a.selected){srv.jQuery("#mopinion_dimmer_overlay").remove(),srv.jQuery("[data-mopinion-screen-capture]").removeAttr("data-mopinion-screen-capture");var o=srv.jQuery.trim(r.outerHTML.replace(/(\r\n|\n|\r)/gm," "));srv.jQuery(r).attr("data-mopinion-screen-capture","");var n='<base href="'+document.location.protocol+"//"+document.location.hostname+'">',i=srv.jQuery.trim(srv.jQuery("html").prop("outerHTML"));if(srv.jQuery("head").find("base").length){if(srv.jQuery("head").find("base").length){var d=srv.jQuery("head").find("base").attr("href")||"",l="";l=-1===d.indexOf(document.location.protocol+"//"+document.location.hostname)?"/"===d.charAt(0)?'<base href="'+document.location.protocol+"//"+document.location.hostname+d+'">':'<base href="'+document.location.protocol+"//"+document.location.hostname+"/"+d+'">':'<base href="'+d+'">',i=i.replace(/(<base)(.*?)(>)/i,function(e,t,r,s){return l})}}else i=i.replace(/(<head)(.*?)(>)/i,function(e,t,r,s){return t+r+s+n});i=i.replace(/(\r\n|\n|\r)/gm," "),t(srv.jQuery(r),!0),srv.jQuery("*").off("click.mopinion_screencapture"),e.embedded?srv.catchCapture({dom:i,selector:o,block_id:e.block_id}):srv.callChildWindow({fn:"srv.catchCapture",data:{dom:i,selector:o,block_id:e.block_id}})}else t(srv.jQuery(r))})},150),t()}function clearCaptureEvents(){setTimeout(function(){srv.jQuery("#mopinion_dimmer_overlay").remove(),srv.jQuery("*").off("click.mopinion_screencapture"),srv.jQuery(document).off("mousemove.mopinion_screencapture"),srv.jQuery(window).off("scroll.mopinion_screencapture"),srv.jQuery("[data-mopinion-screen-capture]").removeAttr("data-mopinion-screen-capture")})}function clearCaptureValues(e){srv.jQuery("#screenshot_"+e.block_id).val("").trigger("change"),srv.jQuery("#dom_"+e.block_id).val(""),srv.jQuery("#selector_"+e.block_id).val(""),srv.jQuery("#"+e.block_id).removeClass("screen-captured"),MS.validateField(srv.jQuery("#screenshot_"+e.block_id)[0])}function toHTMLEntities(e){return e.replace(/./gm,function(e){return"&#"+e.charCodeAt(0)+";"})}function fromHTMLEntities(e){return(e+"").replace(/&#\d+;/gm,function(e){return String.fromCharCode(e.match(/\d+/gm)[0])})}function catchCapture(e){e=e||{},srv.log("Screen capture caught for block :"+e.block_id);var t=fromHTMLEntities(e.selector),r=encodeQuotes(e.dom);srv.jQuery("#selector_"+e.block_id).val(t),srv.jQuery("#dom_"+e.block_id).val(r),srv.jQuery("#screenshot_"+e.block_id).val("https://mopinion-visual-feedback.s3-eu-west-1.amazonaws.com/camera-icon.png").trigger("change"),MS.validateField(srv.jQuery("#screenshot_"+e.block_id)[0]),e.embedded||srv.callParentWindow({fn:"srv.showModalPostCapture"}),t.length>0&&r.length>0?srv.jQuery("#"+e.block_id).addClass("screen-captured"):srv.jQuery("#"+e.block_id).removeClass("screen-captured")}function showModalPostCapture(){srv.slider&&srv.slider.type?srv.jQuery("html,body").addClass("mopinion-slider-active"):srv.jQuery("html,body").addClass("mopinion-modal-active"),srv.jQuery("#surveyWindowWrap, #surveyWindow, #surveyMask").removeClass("screen-capture-active")}function userIdle(e,t){idleTimer=null,idleState=!1,srv.jQuery("*").bind("mousemove keydown scroll",function(r){clearTimeout(idleTimer),idleState,idleState=!1,idleTimer=setTimeout(function(){srv.log("You've been idle for "+e/1e3+" seconds.");var r=new Function(t+"()");modal_open||modal_dismissed||r(),idleState=!0},e)}),srv.jQuery("body").trigger("mousemove")}function userExit(e,t){var r=!1,s=new Function(t+"()");srv.jQuery(document).bind("mouseout",function(e){if(e=e||window.event,mouseFrom=e.relatedTarget||e.toElement,!mouseFrom||"HTML"==mouseFrom.nodeName)var t=e.pageY<100;modal_open||modal_dismissed||!r||t&&(r=!1,s())}),setTimeout(function(){r=!0},e)}function proActiveOpen(e,t){var r=new Function(t+"()");setTimeout(function(){modal_open||modal_dismissed?srv.log("already opened or dismissed"):r()},e)}function triggerForUrl(e,t){var r=document.location.href,s=!!t;e=JSON.parse(e)||{};for(var a in e)if("function"!=typeof e[a]){var o=e[a];if("function"!=typeof o){var n=new RegExp(o,"g");r.match(n)&&(s=!t)}}return s}function scrollToFormPos(e,t,r){t||(t=300),r||(r=10);s=srv.jQuery("#surveyWindow");if($target=srv.jQuery("#surveyWindowWrap"),s[0])a=0;else{var s=srv.jQuery("#surveyContent");$target=srv.jQuery("html, body");var a=s.offset().top}var o=(a=s.offset().top)+e-r;setTimeout(function(){$target.animate({scrollTop:o},t)},50)}function enableNext(){if("undefined"!=typeof survey_properties&&0==survey_properties.advanced.next_button_behaviour||"undefined"==typeof required_map)return!1;var e=required_map[srv.current_page];all_filled=!0,srv.jQuery(e).each(function(e,t){var r=srv.jQuery("#"+t);r&&(void 0===r.val()||""==srv.jQuery.trim(r.val()))&&srv.jQuery(r).parent().is(":visible")&&(all_filled=!1)});var t=srv.jQuery("#page"+srv.current_page),r=t.find("#surveySubmitBtn")[0]?t.find("#surveySubmitBtn"):t.find(".btn-next");"disable"==survey_properties.advanced.next_button_behaviour?r.prop("disabled",!all_filled):"hide"==survey_properties.advanced.next_button_behaviour&&r.toggle(all_filled)}function scrollToSurveyElement(e){if(window!=window.top){getParameterByName("parent",document.location.href);srv.callParentWindow({fn:"srv.scrollToFormPos",data:e})}else scrollToFormPos(e,300,0)}function transitionEnd(){var e,t,r=document.createElement("div"),s={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in s)if(void 0!==r.style[e]){t=s[e];break}return void 0!==t?t:"notransition"}function setLock(){lock_submit=!0,srv.jQuery(".btn-next, .btn-submit").prop("disabled",!0)}function clearLock(){lock_submit=!1,srv.jQuery(".btn-next, .btn-submit").prop("disabled",!1)}function makeStars(e,t){var r,s=e.find('input[type="radio"]'),t=t||{},a=srv.jQuery("#"+t.type+"_"+t.block_id),o=document.createDocumentFragment(),n=!1;t.showCaptions&&(n=srv.jQuery("<span>").addClass("caption")),s.each(function(e,s){var i=srv.jQuery(s),d=i.val(),l=i.attr("title"),c=e+1,u=srv.jQuery("<div>").attr("data-value",d).attr("data-title",l).addClass("ui-stars-star").addClass("star_"+c).on("mouseenter",function(){srv.jQuery(this).removeClass("ui-stars-star-on").siblings(".ui-stars-star").removeClass("ui-stars-star-on"),srv.jQuery(this).addClass("ui-stars-star-hover").prevAll(".ui-stars-star").addClass("ui-stars-star-hover"),n&&n.text(srv.jQuery(this).attr("data-title"))}).on("mouseleave",function(){srv.jQuery(this).removeClass("ui-stars-star-hover").prevAll(".ui-stars-star").removeClass("ui-stars-star-hover"),r&&r.addClass("ui-stars-star-on").prevAll(".ui-stars-star").addClass("ui-stars-star-on"),n&&!r?n.text(""):n&&r&&n.text(r.attr("data-title"))}).on("click",function(){var e=srv.jQuery(this).attr("data-value");a.val(e).trigger("change"),r=srv.jQuery(this),srv.jQuery(this).siblings(".ui-stars-star").removeClass("ui-stars-star-on ui-stars-star-hover"),srv.jQuery(this).addClass("ui-stars-star-on").prevAll(".ui-stars-star").addClass("ui-stars-star-on"),t.callback&&"function"==typeof t.callback&&t.callback()}).appendTo(o);srv.jQuery("<a>").text(d).appendTo(u);i.remove()}),n&&n.appendTo(o),e.append(o)}function niceSelect(e,t){function r(e){e.after(srv.jQuery("<div></div>").addClass("nice-select").addClass(e.attr("class")||"").addClass(e.attr("disabled")?"disabled":"").attr("tabindex",e.attr("disabled")?null:"0").html('<span class="current"></span><ul class="list"></ul>'));var t=e.next(),r=e.find("option"),s=e.find("option:selected");t.find(".current").html(s.data("display")||s.text()),r.each(function(e){var r=srv.jQuery(this),s=r.data("display");t.find("ul").append(srv.jQuery("<li></li>").attr("data-value",r.val()).attr("data-display",s||null).addClass("option"+(r.is(":selected")?" selected":"")+(r.is(":disabled")?" disabled":"")).html(r.text()))})}var s=srv.jQuery("#"+this.div_name);"string"!=typeof t?(e.each(function(){var e=srv.jQuery(this);e.hide(),e.next().hasClass("nice-select")||r(e)}),s.off(".nice_select"),s.on("click.nice_select",".nice-select",function(e){var t=srv.jQuery(this);if(srv.jQuery(".nice-select").not(t).removeClass("open"),t.toggleClass("open"),t.hasClass("open")){t.find(".option"),t.find(".focus").removeClass("focus"),t.find(".selected").addClass("focus");var r=srv.jQuery(window).height();t.offset().top+t.outerHeight()+250>r?t.addClass("list-up"):t.removeClass("list-up")}else t.focus()}),s.on("click.nice_select",function(e){0===srv.jQuery(e.target).closest(".nice-select").length&&srv.jQuery(".nice-select").removeClass("open").find(".option")}),s.on("click.nice_select",".nice-select .option:not(.disabled)",function(e){var t=srv.jQuery(this),r=t.closest(".nice-select");r.find(".selected").removeClass("selected"),t.addClass("selected");var s=t.data("display")||t.text();r.find(".current").text(s),r.prev("select").val(t.data("value")).trigger("change")}),s.on("keydown.nice_select",".nice-select",function(e){var t=srv.jQuery(this),r=srv.jQuery(t.find(".focus")||t.find(".list .option.selected"));if(32==e.keyCode||13==e.keyCode)return t.hasClass("open")?r.trigger("click"):t.trigger("click"),!1;if(40==e.keyCode){if(t.hasClass("open")){var s=r.nextAll(".option:not(.disabled)").first();s.length>0&&(t.find(".focus").removeClass("focus"),s.addClass("focus"))}else t.trigger("click");return!1}if(38==e.keyCode){if(t.hasClass("open")){var a=r.prevAll(".option:not(.disabled)").first();a.length>0&&(t.find(".focus").removeClass("focus"),a.addClass("focus"))}else t.trigger("click");return!1}if(27==e.keyCode)t.hasClass("open")&&t.trigger("click");else if(9==e.keyCode&&t.hasClass("open"))return!1})):"update"==t?e.each(function(){var e=srv.jQuery(this),t=srv.jQuery(this).next(".nice-select"),s=t.hasClass("open");t.length&&(t.remove(),r(e),s&&e.next().trigger("click"))}):"destroy"==t?(e.each(function(){var e=srv.jQuery(this),t=srv.jQuery(this).next(".nice-select");t.length&&(t.remove(),e.css("display",""))}),0==srv.jQuery(".nice-select").length&&s.off(".nice_select")):console.log('Method "'+t+'" does not exist.')}function getMeta(e){if(e)return window_viewport=e.viewport,void(document_title=e.title);srv.outer_modal?(window_viewport=srv.jQuery(window).width()+"x"+srv.jQuery(window).height(),document_title=document.title||""):srv.callParentWindow({fn:"srv.returnMeta"})}function returnMeta(){var e=srv.jQuery(window).width()+"x"+srv.jQuery(window).height();srv.callChildWindow({fn:"srv.getMeta",data:{viewport:e,title:document.title}})}function supportsPointerEvents(e){var t=document.createElement("a").style;return t.cssText="pointer-events:auto","auto"===t.pointerEvents||(e&&srv.jQuery("html").addClass("no-csspointerevents"),!1)}function supportsSvg(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")}function encodeQuotes(e){var t={'"':"&quot;","'":"&#039;"};return e.replace(/["']/g,function(e){return t[e]})}function iOSFix(){var e=parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1;return!(!e||e&&/CriOS/i.test(navigator.userAgent))&&e<=10.3}function fetchVariable(obj){if("string"==typeof obj&&(obj=decodeURIComponent(obj)),"object"!=typeof obj)try{obj=JSON.parse(obj)}catch(e){}var type=obj.type,value=obj.value,hidden_id=obj.hidden_id;srv.log("Fetching "+type+" data from :"+value,"info");var passback="";if("css_selector"===type){var $selector;try{$selector=srv.jQuery(value.replace(/"/g,"'"))}catch(e){}$selector&&(passback="INPUT"===$selector.prop("nodeName")||"TEXTAREA"===$selector.prop("nodeName")?$selector.val():srv.jQuery.trim($selector.text()))}else if("js"===type){var js_var;try{js_var=eval(value)}catch(e){}if(void 0!==js_var){if("object"==typeof js_var)try{js_var=JSON.stringify(js_var)}catch(e){}"string"==typeof js_var&&(passback=js_var)}}else if("cookie"===type){var cookie_val=getCookie(value);cookie_val&&"string"==typeof cookie_val&&(passback=cookie_val)}if(passback)if(srv.log("Data found from "+type+": "+value,"info"),obj.embedded)if(srv.jQuery("#"+hidden_id).length)srv.jQuery("#"+hidden_id).val(passback);else var poll=setInterval(function(){srv.jQuery("#"+hidden_id).length&&(clearInterval(poll),srv.jQuery("#"+hidden_id).val(passback))},50);else srv.callChildWindow({fn:"(function(obj) {srv.jQuery('#'+obj.hidden_id).val(obj.data)})",data:{hidden_id:hidden_id,data:passback}});else srv.log("No data found from "+type+": "+value,"info")}function preloadSlider(e,t,r){e||(e=srv.key);var s=srv.jQuery("#"+srv.div_name),a=(void 0!==document.documentMode&&document.documentMode,(o="undefined"!=typeof mpnndbg&&1==mpnndbg||!1)?"https://"+srv.domain:srv.host),o=o?"debug=1":"",n=srv.jQuery("<div>").attr("id","surveyWindowWrap").css({position:"fixed",zIndex:2000000001,maxHeight:"90%"}).addClass("mopinion-slider slide-"+srv.slider.position),i=(srv.jQuery("<iframe>").attr("id","surveyWindow").attr("src",a+"/survey/public/modal?"+o+"&key="+e+"&domain="+srv.domain+"&version="+srv.version+"&parent="+document.location).attr("frameBorder",!1).attr("allowTransparency",!0).css({border:"none",borderRadius:"2px",width:"100%"}).appendTo(n),{});return"right"===srv.slider.position?i={top:"10%",bottom:"auto",left:"auto",right:0,transform:"translateX(100%)"}:"bottom-right"===srv.slider.position?i={top:"auto",bottom:0,left:"auto",right:"2.5%",transform:"translateY(100%)"}:"bottom-left"===srv.slider.position?i={top:"auto",bottom:0,left:"2.5%",right:"auto",transform:"translateY(100%)"}:"left"===srv.slider.position&&(i={top:"10%",bottom:"auto",left:0,right:"auto",transform:"translateX(-100%)"}),srv.button.hide&&!r||addButton(e).appendTo(n),n.css(i).appendTo(s),sliderWidth(n),srv.jQuery(window).on("resize orientationchange",sliderWidth),t&&"open"===t&&openSlider(!0),!0}function openSlider(e,t){if(t?t!==srv.key&&srv.preloadSlider(t,"open"):t=srv.key,getCookie("MSopened")==t&&!e||modal_open){var r="Not opening, reason: ";modal_open?r+="Already open":getCookie("MSopened")==t&&(r+="Got a cookie, and not forced by user"),isPreview&&srv.jQuery("#surveyPreviewMessageContent").html(r),srv.log(r)}else{e&&srv.log("User forced opening of modal",!1,"info"),modalFirst=!0;srv.jQuery("#surveyWindow");animateTranslate(srv.jQuery("#surveyWindowWrap"),{from:["right","bottom-left","bottom-right"].indexOf(srv.slider.position)>-1?"100":"-100",to:"0",type:["left","right"].indexOf(srv.slider.position)>-1?"x":"y"},function(){srv.jQuery("html,body").addClass("mopinion-slider-active"),modal_open=!0,srv.triggerEvent("shown"),setCookies()})}return!0}function closeSlider(){var e=srv.jQuery("#surveyWindowWrap"),t=srv.jQuery("#surveyWindow");srv.clearCaptureEvents(),t.trigger("mopinion.modal_hide"),animateTranslate(e,{to:["right","bottom-left","bottom-right"].indexOf(srv.slider.position)>-1?"100":"-100",type:["left","right"].indexOf(srv.slider.position)>-1?"x":"y"},function(){modalFirst=!1,modal_open=!1,srv.jQuery("html,body").removeClass("mopinion-slider-active"),srv.triggerEvent("hidden")})}function sliderWidth(e){var t=srv.jQuery(window).width();$iframe=MS.isDOM(e)||MS.isDOM(e[0])?e:srv.jQuery("#surveyWindowWrap"),t>1200?frameWidth="425px":t>992&&t<1201?frameWidth="380px":t<993&&t>768?frameWidth="380px":t<769&&t>544?frameWidth="320px":545>t&&(frameWidth="260px"),$iframe.css({width:frameWidth})}function animateTranslate(e,t,r){if(e&&"object"==typeof t){var s="y"!=t.type?"translateX":"translateY",a=t.unit?t.unit:"%",o=t.from||0;srv.jQuery({noop:o}).animate({noop:t.to},{duration:t.duration||225,step:function(t,r){e.css("transform",s+"("+t+a+")")},complete:r||!1})}}var current_block,resize_int,modalFirst=!0,modal_open=!1,modal_dismissed=!1,show_pm_log=!1,followUpId=!1,sendMode="insert",hide_on_init=[],lock_submit=!1,required_when_visible=[],error_messages={deflt:"Something went wrong",required:"This field is required",required_multi:"All fields are required",invalid_number:"This is not a valid number",invalid_phone:"This is not a valid phone number",invalid_email:"This is not a valid email address",too_short:"The answer is too short",too_long:"The answer is too long"},touch_css={"-ms-touch-action":"manipulation","touch-action":"manipulation"},isPreview=document.location.pathname.indexOf("/survey/manage/preview/")>-1,host="https://collect.mopinion.com",version="1.2",domain="mopinion",remote,outer_modal,prev_page,next_page,current_page=1,page_count=1,page_history={},show_log=!0,rules_set=[],question_count=0,show_progress=!1,window_viewport,document_title,user_touching=!1,isIE=document.documentMode&&(8==document.documentMode||9==document.documentMode),eventsHandlers={form_loaded:[]},Sobject={};Sobject.resizeListener=resizeListener,Sobject.callParentWindow=callParentWindow,Sobject.callChildWindow=callChildWindow,Sobject.resizeForm=resizeForm,Sobject.send=send,Sobject.appendScript=appendScript,Sobject.appendStyle=appendStyle,Sobject.loadSurvey=loadSurvey,Sobject.loadScripts=loadScripts,Sobject.loadJSON=loadJSON,Sobject.buildForm=buildForm,Sobject.generateHTML=generateHTML,Sobject.log=log,Sobject.prevPage=prevPage,Sobject.nextPage=nextPage,Sobject.setValue=setValue,Sobject.submitSurvey=submitSurvey,Sobject.openModal=openModal,Sobject.closeModal=closeModal,Sobject.hideLoader=hideLoader,Sobject.request=request,Sobject.updateProgress=updateProgress,Sobject.getLanguage=getLanguage,Sobject.removeButton=removeButton,Sobject.addButton=addButton,Sobject.showButton=showButton,Sobject.getParameterByName=getParameterByName,Sobject.makeStars=makeStars,Sobject.niceSelect=niceSelect,Sobject.setCookie=setCookie,Sobject.getCookie=getCookie,Sobject.setCookies=setCookies,Sobject.triggerEvent=triggerEvent,Sobject.on=EventHandler,Sobject.initEvent=EventInitializer,Sobject.loadjQuery=loadjQuery,Sobject.loadjQueryHandler=loadjQueryHandler,Sobject.proActiveOpen=proActiveOpen,Sobject.userExit=userExit,Sobject.triggerForUrl=triggerForUrl,Sobject.setPrefill=setPrefill,Sobject.hideBlock=hideBlock,Sobject.unhideBlock=unhideBlock,Sobject.scrollToFormPos=scrollToFormPos,Sobject.initCapture=initCapture,Sobject.catchCapture=catchCapture,Sobject.showModalPostCapture=showModalPostCapture,Sobject.clearCaptureEvents=clearCaptureEvents,Sobject.clearCaptureValues=clearCaptureValues,Sobject.getMeta=getMeta,Sobject.returnMeta=returnMeta,Sobject.fetchVariable=fetchVariable,Sobject.preloadSlider=preloadSlider,Sobject.openSlider=openSlider,Sobject.closeSlider=closeSlider,Sobject.sliderWidth=sliderWidth,Sobject.page_count=page_count,Sobject.current_page=current_page,Sobject.prev_page=prev_page,Sobject.next_page=next_page,Sobject.page_history=page_history,Sobject.show_log=show_log,Sobject.domain=domain,Sobject.version=version,Sobject.remote=remote,Sobject.question_count=question_count,Sobject.show_progress=show_progress,Sobject.host=host,Sobject.eventsHandlers=eventsHandlers;try{console.info("loading Surveys "+version)}catch(e){}return Sobject}(),MS=function(){function t(e){var t=[];for(var r in e)"function"!=typeof e[r]&&void 0!==e[r]&&t.push(e[r]);return t}function r(e){var t=e.indexOf("@"),r=e.lastIndexOf(".");return!(t<1||r<t+2||r+2>=e.length)}function s(e,t){for(var r=0;r<e.length;r++)if("string"==typeof t){if(e[r]==t)return!0}else if("object"==typeof t&&e[r].match(t))return!0;return!1}MSobject={};var a=[],o=new RegExp(/^len[0-9]+/),n=new RegExp(/^max_len[0-9]+/),i=new RegExp(/^(((0)[1-9]{2}[0-9][-]?[1-9][0-9]{5})|((\+31|0|0031)[1-9][0-9][-]?[1-9][0-9]{6}))|((\\+31|0|0031)6){1}[-]?[1-9]{1}[0-9]{7}$/);new RegExp(/^[1-9][0-9]{3}[\s]?[A-Za-z]{2}$/i);return Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),MSobject.inArray=s,MSobject.log=function(e,t,r){if(r&&"log"!=r){if("warn"==r){if(srv.show_log||!0===t)try{console.warn(e)}catch(e){}}else if("info"==r){if(srv.show_log||!0===t)try{console.info(e)}catch(e){}}else if("error"==r)throw new Error(e)}else if(srv.show_log||!0===t)try{console.log(e)}catch(e){}},MSobject.validateAll=function(t,r){var s=!0;if(t){a=[];for(f in t)jQuery("#"+t[f]).hasClass("req")&&a.push(jQuery("#"+t[f])[0])}else var a=jQuery(".req").toArray();for(var o=0;o<a.length;o++){var n=a[o];if(-1!=navigator.userAgent.indexOf("MSIE 8.0")?(setTimeout(function(){"object"==typeof n&&n.focus()},0),setTimeout(function(){"object"==typeof n&&n.blur()},0)):(n.focus(),n.blur()),""==n.value||null==n.value||-1!=n.className.indexOf("numeric")&&0==n.value||-1!=n.className.indexOf("phone")&&!n.value.match(i)){var d=MS.validateField(n);r&&r(n,d),s=!1}"checkbox"==n.type&&(MS.unsetError(n),n.checked||(MS.setError(n),s=!1))}if(0!=this.errors.length)if(t)for(e in this.errors)"function"!=typeof this.errors[e]&&t.indexOf(this.errors[e])>-1&&(s=!1);else s=!1;return s},MSobject.validateEmail=r,MSobject.validateField=function(e,t,a){if($field=jQuery(e),$field[0]){var d,l=!0,c=!1,u=!1,p=!0,v=!0,f=!0,m=!1,h=e.className.split(" "),y=$field.hasClass("email"),g=$field.hasClass("numeric"),b=$field.hasClass("phone"),_=$field.hasClass("req");if(s(h,o)||s(h,n))for(var j=0;j<h.length;j++)h[j].search(o)>-1&&(u=h[j].replace("len","")),h[j].search(n)>-1&&(c=h[j].replace("max_len",""));return jQuery.trim(e.value).length<u?(l=!1,d="too_short"):!1!==c&&jQuery.trim(e.value).length>c&&e.value!==t&&(l=!1,d="too_long"),b&&$field.val()!=t&&""!==jQuery.trim($field.val())&&(e.value.match(i)||(f=!1)),g&&$field.val()!==t&&""!==jQuery.trim($field.val())&&((parseInt($field.val())||parseFloat($field.val()))&&isFinite($field.val())&&0!=parseFloat($field.val())||(v=!1)),y&&""!==jQuery.trim($field.val())&&(p=r($field.val())),!1===v||!1===p||!1===f||!1===l||(""===jQuery.trim($field.val())||null===$field.val()||$field.val()===t)&&_?(null!==t&&""===jQuery.trim($field.val())&&void 0!==t&&$field.val(t),p?f?v?d||(d="required"):d="invalid_number":d="invalid_phone":d="invalid_email",MS.setError($field),m=!1):(MS.unsetError($field),m=!0),return_obj={state:m,code:d}}},MSobject.setError=function(e){var t=e.attr("id");jQuery("#"+t+"_error_style");s(this.errors,t)||this.errors.push(t),e.addClass("error"),e.parent().addClass("error")},MSobject.unsetError=function(e){if(e instanceof jQuery==0)var e=jQuery(e);var r=e.attr("id"),s=this.errors;e.removeClass("error"),e.parent().removeClass("error"),jQuery("#"+r+"_error").remove(),jQuery(s).each(function(e,t){t==r&&delete s[e]}),this.errors=t(s)},MSobject.getCookie=function(e){var t,r,s,a=document.cookie.split(";");for(t=0;t<a.length;t++)if(r=a[t].substr(0,a[t].indexOf("=")),s=a[t].substr(a[t].indexOf("=")+1),(r=r.replace(/^\s+|\s+$/g,""))==e)return unescape(s)},MSobject.setCookie=function(e,t,r,s,a){var o=new Date;-1==r?(o.setMonth(o.getMonth()-1),cexp="expires="+o+";"):1==r?(o.setMonth(o.getMonth()+1),cexp="expires="+o+";"):cexp="",cpath=s?"path="+s+";":"path="+document.location.pathname+";",cdomain=a?"domain="+a+";":"";var n=e+"="+t+";"+cexp+cpath+cdomain;document.cookie=n},MSobject.isDOM=function(e){return"HTMLElement"in window?e&&e instanceof HTMLElement:!(!e||"object"!=typeof e||1!==e.nodeType||!e.nodeName)},MSobject.hammerTime=function(){var e=window.MutationObserver||window.WebKitMutationObserver,t="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;if(void 0===document.documentElement.style["touch-action"]&&!document.documentElement.style["-ms-touch-action"]&&t&&e){window.Hammer=window.Hammer||{};var r=/touch-action[:][\s]*(none)[^;'"]*/,s=/touch-action[:][\s]*(manipulation)[^;'"]*/,a=/touch-action/,o=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),n=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}()&&o;window.Hammer.time={getTouchAction:function(e){return this.checkStyleString(e.getAttribute("style"))},checkStyleString:function(e){if(a.test(e))return r.test(e)?"none":!s.test(e)||"manipulation"},shouldHammer:function(e){var t=this.hasParent(e.target);return!(!t||n&&!(Date.now()-e.target.lastStart<125))&&t},touchHandler:function(e){var t=e.target.getBoundingClientRect(),r=t.top!==this.pos.top||t.left!==this.pos.left,s=this.shouldHammer(e);("none"===s||!1===r&&"manipulation"===s)&&("touchend"===e.type&&(e.target.focus(),setTimeout(function(){e.target.click()},0)),e.preventDefault()),this.scrolled=!1,delete e.target.lastStart},touchStart:function(e){this.pos=e.target.getBoundingClientRect(),n&&this.hasParent(e.target)&&(e.target.lastStart=Date.now())},styleWatcher:function(e){e.forEach(this.styleUpdater,this)},styleUpdater:function(e){if(e.target.updateNext)e.target.updateNext=!1;else{var t=this.getTouchAction(e.target);t?"none"!==t&&(e.target.hadTouchNone=!1):!t&&(e.oldValue&&this.checkStyleString(e.oldValue)||e.target.hadTouchNone)&&(e.target.hadTouchNone=!0,e.target.updateNext=!1,e.target.setAttribute("style",e.target.getAttribute("style")+" touch-action: none;"))}},hasParent:function(e){for(var t,r=e;r&&r.parentNode;r=r.parentNode)if(t=this.getTouchAction(r))return t;return!1},installStartEvents:function(){document.addEventListener("touchstart",this.touchStart.bind(this)),document.addEventListener("mousedown",this.touchStart.bind(this))},installEndEvents:function(){document.addEventListener("touchend",this.touchHandler.bind(this),!0),document.addEventListener("mouseup",this.touchHandler.bind(this),!0)},installObserver:function(){this.observer=new e(this.styleWatcher.bind(this)).observe(document,{subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["style"]})},install:function(){this.installEndEvents(),this.installStartEvents(),this.installObserver()}},window.Hammer.time.install()}},MSobject.errors=a,MSobject}();